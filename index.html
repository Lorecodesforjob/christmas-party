
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secret Christmas Party Invitation</title>
    <!-- EmailJS SDK -->
<script type="text/javascript" src="https://media.giphy.com/media/v1.Y2lkPWVjZjA1ZTQ3MngxNzB3a2M1dnR3emlubmNuYWNoYmFzYzdrc21xMno0cmZxMTl0NiZlcD12MV9naWZzX3NlYXJjaCZjdD1n/R0QUlihXieN9a1e0oO/giphy.gif"></script>
<script type="text/javascript">
    (function(){
        emailjs.init("2mYwlD1nIrfL1ixbp");
    })();
</script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéÑ</text></svg>">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a3a 0%, #0d1b2a 100%);
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow-x: hidden;
        }
        
        /* Pok√©mon-themed background */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(255, 255, 255, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(255, 255, 255, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.03) 0%, transparent 30%);
            z-index: -1;
        }
        
        .container {
            max-width: 1000px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            width: 100%;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #aaa;
            margin-bottom: 20px;
        }
        
        .screen {
            background-color: rgba(30, 30, 46, 0.9);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            width: 100%;
            max-width: 800px;
            margin-bottom: 20px;
            display: none;
            text-align: center;
        }
        
        .active {
            display: block;
        }
        
        .invitation-card {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .invitation-card h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: #fff;
        }
        
        .invitation-card p {
            font-size: 1.2rem;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        
        .btn {
            padding: 12px 30px;
            background: linear-gradient(90deg, #ff6b6b, #ff8e8e);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 10px;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.6);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: linear-gradient(90deg, #4ecdc4, #2a9d8f);
            box-shadow: 0 5px 15px rgba(78, 205, 196, 0.4);
        }
        
        .btn-secondary:hover {
            box-shadow: 0 8px 20px rgba(78, 205, 196, 0.6);
        }
        
        .btn-admin {
            background: linear-gradient(90deg, #ffd166, #ff9e66);
            color: #000;
            box-shadow: 0 5px 15px rgba(255, 209, 102, 0.4);
        }
        
        .btn-admin:hover {
            box-shadow: 0 8px 20px rgba(255, 209, 102, 0.6);
        }
        
        .survey-options {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
        }
        
        .option-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            width: 200px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .option-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.15);
            border-color: #4ecdc4;
        }
        
        .option-card.selected {
            background: rgba(78, 205, 196, 0.2);
            border-color: #4ecdc4;
            transform: translateY(-5px);
        }
        
        .option-title {
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: #4ecdc4;
        }
        
        .option-desc {
            font-size: 0.9rem;
            color: #ccc;
        }
        
        .option-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .game-area {
            background-color: #0f0f1a;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            margin: 20px 0;
            border: 2px solid #2a2a3e;
            width: 100%;
            height: 500px;
        }
        
        #gameCanvas {
            display: block;
            background: linear-gradient(to bottom, #1e3c72, #2a5298);
            width: 100%;
            height: 100%;
            cursor: crosshair;
        }
        
        .game-stats {
            display: flex;
            justify-content: space-around;
            width: 100%;
            margin-bottom: 20px;
        }
        
        .stat {
            text-align: center;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #ff6b6b;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #aaa;
        }
        
        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #aaa;
            font-size: 1rem;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid #444;
            border-radius: 5px;
            color: white;
            font-size: 1rem;
        }
        
        /* FIXED: Better contrast for select dropdown */
        select {
            background-color: rgba(30, 30, 46, 0.9);
            border: 2px solid #4ecdc4;
            color: white;
        }
        
        select option {
            background-color: #1a2a3a;
            color: white;
            padding: 10px;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #4ecdc4;
        }
        
        .results {
            background-color: rgba(30, 30, 46, 0.9);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
        }
        
        .results h3 {
            margin-bottom: 15px;
            color: #4ecdc4;
        }
        
        .progress-container {
            width: 100%;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 30px;
            background: linear-gradient(90deg, #ff6b6b, #ff8e8e);
            border-radius: 10px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .snowflake {
            position: absolute;
            color: white;
            font-size: 20px;
            user-select: none;
            pointer-events: none;
            z-index: 1;
            animation: fall linear infinite;
        }
        
        @keyframes fall {
            to {
                transform: translateY(100vh);
            }
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f00;
            opacity: 0.7;
            z-index: 100;
            animation: confetti-fall 3s ease-in forwards;
        }
        
        @keyframes confetti-fall {
            0% {
                transform: translateY(-100px) rotate(0deg);
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
            }
        }
        
        footer {
            margin-top: 30px;
            text-align: center;
            color: #777;
            font-size: 0.9rem;
            width: 100%;
            padding: 20px;
            border-top: 1px solid #2a2a3e;
        }
        
        .instructions {
            background-color: rgba(30, 30, 46, 0.8);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            font-size: 0.9rem;
            color: #ccc;
        }
        
        .hidden {
            display: none;
        }
        
        .party-date {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ff6b6b;
            margin: 20px 0;
            padding: 15px;
            background: rgba(255, 107, 107, 0.1);
            border-radius: 10px;
            border: 2px solid #ff6b6b;
        }
        
        .quote-game {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .quote-text {
            font-size: 1.2rem;
            font-style: italic;
            margin-bottom: 20px;
            color: #fff;
            line-height: 1.6;
        }
        
        .quote-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .quote-option {
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .quote-option:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: #4ecdc4;
        }
        
        .quote-option.correct {
            background: rgba(78, 205, 196, 0.3);
            border-color: #4ecdc4;
        }
        
        .quote-option.incorrect {
            background: rgba(255, 107, 107, 0.3);
            border-color: #ff6b6b;
        }
        
        .email-notification {
            background: rgba(78, 205, 196, 0.2);
            border: 2px solid #4ecdc4;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            color: #4ecdc4;
        }
        
        .attendees-count {
            font-size: 1.2rem;
            margin: 10px 0;
            color: #4ecdc4;
        }
        
        .already-submitted {
            background: rgba(255, 107, 107, 0.2);
            border: 2px solid #ff6b6b;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        .already-submitted h3 {
            color: #ff6b6b;
            margin-bottom: 10px;
        }
        
        .music-game {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .music-player {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .music-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 20px 0;
        }
        
        .music-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #4ecdc4;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.5rem;
        }
        
        .music-btn:hover {
            background: rgba(78, 205, 196, 0.2);
            transform: scale(1.1);
        }
        
        .music-btn:active {
            transform: scale(0.95);
        }
        
        .play-btn {
            background: rgba(78, 205, 196, 0.3);
            width: 80px;
            height: 80px;
            font-size: 2rem;
        }
        
        .play-btn.playing {
            background: rgba(255, 107, 107, 0.3);
            border-color: #ff6b6b;
        }
        
        .song-title {
            font-size: 1.3rem;
            margin: 15px 0;
            color: #ffd166;
            font-weight: bold;
        }
        
        .hint-text {
            font-size: 0.9rem;
            color: #aaa;
            margin-top: 10px;
        }
        
        .admin-section {
            background: rgba(255, 209, 102, 0.1);
            border: 2px solid #ffd166;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .admin-section h3 {
            color: #ffd166;
            margin-bottom: 15px;
        }

        /* Budget Allocation Styles */
        .budget-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .budget-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 15px;
        }

        .budget-total {
            font-size: 1.2rem;
            color: #ffd166;
            font-weight: bold;
        }

        .budget-option {
            margin: 15px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        .budget-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .budget-amount {
            color: #4ecdc4;
            font-weight: bold;
        }

        .budget-slider {
            width: 100%;
            margin: 10px 0;
        }

        .budget-remaining {
            text-align: center;
            margin-top: 15px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            font-weight: bold;
        }

        .budget-remaining.over-budget {
            background: rgba(255, 107, 107, 0.2);
            color: #ff6b6b;
        }

        .budget-remaining.under-budget {
            background: rgba(78, 205, 196, 0.2);
            color: #4ecdc4;
        }

        /* Music Control Styles */
        .global-music-controls {
            display: none; /* Hide music controls */
        }

        .music-toggle {
            display: none; /* Hide music toggle */
        }

        .volume-slider {
            display: none; /* Hide volume slider */
        }

        /* Wordle Game Styles */
        .wordle-game {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .wordle-grid {
            display: grid;
            grid-template-rows: repeat(5, 1fr);
            gap: 5px;
            margin: 20px 0;
        }

        .wordle-row {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 5px;
        }

        .wordle-cell {
            width: 60px;
            height: 60px;
            border: 2px solid #3a3a3c;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
            font-weight: bold;
            background-color: transparent;
            color: white;
            transition: all 0.3s ease;
        }

        .wordle-cell.correct {
            background-color: #538d4e;
            border-color: #538d4e;
        }

        .wordle-cell.present {
            background-color: #b59f3b;
            border-color: #b59f3b;
        }

        .wordle-cell.absent {
            background-color: #3a3a3c;
            border-color: #3a3a3c;
        }

        .wordle-input-container {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }

        .wordle-input {
            width: 200px;
            padding: 10px;
            font-size: 1.2rem;
            text-align: center;
            text-transform: uppercase;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #4ecdc4;
            border-radius: 5px;
            color: white;
        }

        .wordle-input:focus {
            outline: none;
            border-color: #4ecdc4;
        }

        .wordle-complete {
            text-align: center;
            margin: 20px 0;
        }

        /* Music Player Button */
        .music-player-btn {
            display: none; /* Hide music player button */
        }

        /* Pok√©mon Game Styles - UPDATED */
        .pokemon-silhouette {
            filter: brightness(0) contrast(0);
            max-width: 200px;
            max-height: 200px;
        }

        .pokemon-revealed {
            filter: none !important;
        }

        .pokemon-option {
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .pokemon-option:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: #4ecdc4;
        }

        .pokemon-option.correct {
            background: rgba(78, 205, 196, 0.3);
            border-color: #4ecdc4;
        }

        .pokemon-option.incorrect {
            background: rgba(255, 107, 107, 0.3);
            border-color: #ff6b6b;
        }

        /* Snowman Hit Area Info */
        .hit-area-info {
            background-color: rgba(78, 205, 196, 0.2);
            border: 2px solid #4ecdc4;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
        }

        .snowman-example {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }

        .snowman-demo {
            position: relative;
            width: 120px;
            height: 180px;
        }

        .snowman-body {
            position: absolute;
            width: 100px;
            height: 100px;
            background: white;
            border-radius: 50%;
            bottom: 0;
            left: 10px;
        }

        .snowman-middle {
            position: absolute;
            width: 80px;
            height: 80px;
            background: white;
            border-radius: 50%;
            bottom: 70px;
            left: 20px;
        }

        .snowman-head {
            position: absolute;
            width: 60px;
            height: 60px;
            background: white;
            border-radius: 50%;
            bottom: 130px;
            left: 30px;
        }

        .hit-area {
            position: absolute;
            width: 120px;
            height: 180px;
            border: 2px dashed #ff6b6b;
            border-radius: 60px;
            bottom: 0;
            left: 0;
        }

        .highlight {
            color: #ffd166;
            font-weight: bold;
        }

        /* Pok√©mon TCG Carousel Styles - UPDATED WITH LIGHT BACKGROUND */
        .tcg-carousel {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin: 30px auto;
            perspective: 1000px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); /* LIGHT BACKGROUND */
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .carousel-container {
            position: relative;
            width: 100%;
            height: 500px;
            overflow: hidden;
            border-radius: 15px;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%); /* LIGHT BACKGROUND */
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        .carousel-track {
            display: flex;
            transition: transform 0.5s ease-in-out;
            height: 100%;
        }

        .carousel-slide {
            min-width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .carousel-nav {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }

        .carousel-progress {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
        }

        .progress-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .progress-dot.active {
            background: #4ecdc4;
            transform: scale(1.2);
        }

        .progress-dot.visited {
            background: rgba(78, 205, 196, 0.6);
        }

        .carousel-instructions {
            text-align: center;
            color: #666;
            margin: 15px 0;
            font-style: italic;
        }

        /* REDESIGNED: Pok√©mon Card Styles - REAL POK√âMON TCG LAYOUT */
        .pokemon-tcg-card {
            width: 380px; /* REDUCED SIZE for better fit */
            height: 530px; /* REDUCED SIZE for better fit */
            border-radius: 20px;
            padding: 15px;
            box-shadow: 
                0 15px 35px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.4);
            border: 8px solid #ff6b6b;
            position: relative;
            animation: cardReveal 0.8s ease-out;
            color: #111;
            font-family: 'Arial', 'Helvetica', sans-serif;
            font-weight: 700;
            text-shadow: 0 1px 1px rgba(255, 255, 255, 0.5);
            display: flex;
            flex-direction: column;
            overflow: hidden; /* Prevent overflow */
        }

        @keyframes cardReveal {
            0% {
                opacity: 0;
                transform: scale(0.8) rotateY(180deg);
            }
            100% {
                opacity: 1;
                transform: scale(1) rotateY(0deg);
            }
        }

        /* Card Header - Pok√©mon Name and HP - FIXED: Extended header area */
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            padding: 12px 15px;
            border-bottom: 3px solid rgba(0, 0, 0, 0.2);
            min-height: 70px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px 8px 0 0;
        }

        .card-title {
            font-size: 1.6rem;
            font-weight: bold;
            color: #222;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
            max-width: 70%;
            word-wrap: break-word;
            line-height: 1.2;
            padding-top: 5px;
        }

        .card-hp {
            font-size: 1.2rem;
            color: #222;
            font-weight: bold;
            background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
            padding: 5px 15px;
            border-radius: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            min-width: 70px;
            text-align: center;
        }

        .hp-value {
            color: #fff;
        }

        /* Main Pok√©mon Art Section - FIXED: LARGER CONTAINER FOR GIFS */
        .card-art-container {
            border-radius: 12px;
            height: 320px; /* INCREASED to fit GIFs better */
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
            position: relative;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.6);
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.1);
            background: rgba(255, 255, 255, 0.1);
        }

        .pokemon-type {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            z-index: 2;
        }

        /* FIXED: Pok√©mon GIF sizing - larger and properly fitted */
        .pokemon-art {
            max-width: 280px; /* INCREASED to fit better */
            max-height: 280px; /* INCREASED to fit better */
            width: auto;
            height: auto;
            object-fit: contain; /* Ensure full GIF is visible */
        }

        /* Type Badge */
        .card-type-section {
            text-align: center;
            margin-bottom: 8px;
        }

        .type-badge {
            background: linear-gradient(135deg, #ffd166, #ff9e66);
            color: #222;
            padding: 8px 20px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: bold;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
            display: inline-block;
        }

        /* Card Information Section */
        .card-info-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .card-description {
            font-size: 0.85rem;
            color: #333;
            line-height: 1.4;
            text-align: center;
            padding: 8px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            font-weight: 600;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .card-attacks {
            background: rgba(255, 255, 255, 0.4);
            border-radius: 8px;
            padding: 10px;
        }

        .attack {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
            padding: 5px 8px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 6px;
            border-left: 4px solid #4ecdc4;
        }

        .attack-name {
            font-weight: bold;
            color: #222;
            font-size: 0.9rem;
        }

        .attack-damage {
            color: #ff6b6b;
            font-weight: bold;
            font-size: 1rem;
        }

        .card-weakness-resistance {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 0.85rem;
            background: rgba(255, 255, 255, 0.4);
            padding: 8px;
            border-radius: 8px;
        }

        .weakness, .resistance {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .label {
            color: #555;
            font-weight: bold;
        }

        .value {
            color: #222;
            font-weight: bold;
        }

        .card-footer {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            color: #666;
            margin-top: 10px;
            padding-top: 8px;
            border-top: 2px solid rgba(0, 0, 0, 0.1);
        }

        /* Secret Santa Card Styles - IMPROVED SHINING EFFECT */
        .secret-santa-card {
            background: linear-gradient(135deg, #d4a5ff, #b388fe, #ff6bc9);
            border-color: gold;
            animation: secretSantaReveal 1s ease-out;
            position: relative;
            overflow: hidden;
        }

        .secret-santa-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent,
                rgba(255, 255, 255, 0.3),
                transparent,
                rgba(255, 255, 255, 0.2),
                transparent
            );
            transform: rotate(45deg);
            animation: shine 3s infinite;
            z-index: 1;
        }

        @keyframes shine {
            0% {
                transform: translateX(-100%) translateY(-100%) rotate(45deg);
            }
            100% {
                transform: translateX(100%) translateY(100%) rotate(45deg);
            }
        }

        @keyframes secretSantaReveal {
            0% {
                transform: scale(0.5) rotate(-10deg);
                opacity: 0;
            }
            50% {
                transform: scale(1.1) rotate(5deg);
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        .secret-santa-card .card-art-container {
            background: linear-gradient(135deg, #b388fe, #d4a5ff);
            border: 4px solid gold;
        }

        /* REMOVED: Gift suggestion box and assigned player styles */
        /* Gift rules integrated into card design */
        .gift-rules {
            background: #ffffff;
            border-radius: 8px;
            padding: 12px;
            margin-top: 10px;
            color: #333;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border: 1px solid #e0e0e0;
            position: relative;
            z-index: 2;
            font-size: 0.8rem;
        }

        .gift-rules h4 {
            color: #222;
            margin-bottom: 8px;
            text-align: center;
            font-size: 0.9rem;
        }

        .gift-rules ul {
            text-align: left;
            color: #444;
            font-size: 0.75rem;
            margin: 0;
            padding-left: 15px;
        }

        .gift-rules li {
            margin-bottom: 4px;
        }

        /* Card Rarity Effects */
        .card-rarity {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 30px;
            height: 30px;
            background: gold;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
            color: #333;
            box-shadow: 0 2px 10px rgba(255, 215, 0, 0.5);
            z-index: 3;
        }

        /* Holo Effect for Rare Cards */
        .holo-effect {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                125deg,
                transparent 30%,
                rgba(255, 255, 255, 0.3) 50%,
                transparent 70%
            );
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            border-radius: 12px;
            z-index: 1;
        }

        .pokemon-tcg-card:hover .holo-effect {
            opacity: 1;
        }

        /* Secret Santa Assignment Display */
        .santa-assignment {
            text-align: center;
            margin: 10px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            border: 2px dashed #ff6b6b;
        }

        .player-assignment {
            font-size: 1.4rem;
            font-weight: bold;
            color: #ff6b6b;
            margin: 5px 0;
        }

        .assignment-text {
            font-size: 1rem;
            color: #111;
            font-weight: bold;
        }

        /* Anonymous Results Styles */
        .anonymous-results {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #4ecdc4;
        }

        .results-category {
            margin-bottom: 25px;
        }

        .results-category h4 {
            color: #4ecdc4;
            margin-bottom: 15px;
            text-align: center;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border-left: 4px solid #ff6b6b;
        }

        .result-label {
            font-weight: bold;
            color: #fff;
        }

        .result-value {
            color: #ffd166;
            font-weight: bold;
        }

        .result-bar {
            height: 20px;
            background: linear-gradient(90deg, #4ecdc4, #2a9d8f);
            border-radius: 10px;
            margin: 5px 0;
            transition: width 0.5s ease;
        }

        .result-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: #aaa;
            margin-top: 5px;
        }

        .total-points {
            text-align: center;
            font-size: 1.2rem;
            color: #ffd166;
            margin: 20px 0;
            padding: 15px;
            background: rgba(255, 209, 102, 0.1);
            border-radius: 10px;
            border: 2px solid #ffd166;
        }

        .results-note {
            text-align: center;
            color: #aaa;
            font-size: 0.9rem;
            margin-top: 15px;
            font-style: italic;
        }

        /* Carousel Navigation Buttons */
        .carousel-btn {
            padding: 12px 25px;
            background: linear-gradient(90deg, #4ecdc4, #2a9d8f);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(78, 205, 196, 0.4);
        }

        .carousel-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(78, 205, 196, 0.6);
        }

        .carousel-btn:disabled {
            background: rgba(0, 0, 0, 0.2);
            color: #aaa;
            cursor: not-allowed;
            box-shadow: none;
        }

        .carousel-btn.prev {
            background: linear-gradient(90deg, #ff6b6b, #ff8e8e);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        .carousel-btn.prev:hover:not(:disabled) {
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.6);
        }

        /* Keyboard Navigation Hints */
        .keyboard-hints {
            text-align: center;
            color: #777;
            font-size: 0.8rem;
            margin-top: 10px;
        }

        /* Mobile Swipe Support */
        .carousel-container.swiping {
            transition: none;
        }

        /* Pack Opening Styles - UPDATED WITH FESTIVE BACKGROUND */
        .pack-opening-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin: 30px auto;
            min-height: 600px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(255, 107, 107, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(78, 205, 196, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(255, 209, 102, 0.1) 0%, transparent 50%),
                url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="50" font-size="20" fill="%23ff6b6b" opacity="0.1">‚ùÑ</text></svg>');
        }

        .tcg-pack {
            width: 300px;
            height: 400px;
            perspective: 1000px;
            cursor: pointer;
            position: relative;
            margin: 0 auto 20px;
            transition: transform 0.3s ease;
        }

        .tcg-pack:hover {
            transform: translateY(-5px);
        }

        .tcg-pack.opening {
            cursor: default;
        }

        .pack-front {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
            border-radius: 15px;
            position: relative;
            transform-style: preserve-3d;
            transition: all 0.6s ease;
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3),
                inset 0 -10px 20px rgba(0, 0, 0, 0.2);
            border: 5px solid #ffd166;
        }

        .tcg-pack:hover .pack-front {
            transform: translateY(-10px) rotateX(5deg);
            box-shadow: 
                0 15px 40px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3),
                inset 0 -10px 20px rgba(0, 0, 0, 0.2);
        }

        .tcg-pack.opening .pack-front {
            transform: rotateX(180deg) translateY(-50px);
            opacity: 0;
        }

        .pack-art {
            position: absolute;
            top: 20%;
            left: 10%;
            right: 10%;
            text-align: center;
        }

        .pokemon-pack-art {
            font-size: 8rem;
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.5));
            margin-bottom: 20px;
        }

        .energy-symbols {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        .energy {
            font-size: 2rem;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            animation: float 3s ease-in-out infinite;
        }

        .energy-grass { animation-delay: 0s; }
        .energy-fire { animation-delay: 1s; }
        .energy-water { animation-delay: 2s; }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .pack-info {
            position: absolute;
            bottom: 30px;
            left: 0;
            right: 0;
            text-align: center;
            color: white;
        }

        .pack-title {
            font-size: 2rem;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            margin-bottom: 5px;
        }

        .pack-subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .pack-set {
            font-size: 0.9rem;
            opacity: 0.7;
            font-family: monospace;
        }

        .pack-flap {
            position: absolute;
            top: -10px;
            left: 20px;
            right: 20px;
            height: 20px;
            background: linear-gradient(135deg, #ffd166, #ff9e66);
            border-radius: 10px 10px 0 0;
            box-shadow: 0 -5px 10px rgba(0, 0, 0, 0.2);
        }

        .pack-instructions {
            text-align: center;
            color: #666;
            font-style: italic;
            margin: 15px 0;
        }

        /* Flying Cards Animation - UPDATED */
        .cards-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            margin: 0;
            pointer-events: none;
            z-index: 1000;
        }

        .flying-card {
            position: absolute;
            width: 200px;
            height: 280px;
            background: linear-gradient(135deg, #4ecdc4, #2a9d8f);
            border-radius: 12px;
            transform-style: preserve-3d;
            animation: flyAroundScreen 2.5s ease-out forwards;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            border: 3px solid #ffd166;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: white;
            opacity: 0;
            left: 50%;
            top: 50%;
            margin-left: -100px;
            margin-top: -140px;
        }

        .flying-card:nth-child(1) { 
            animation-delay: 0.1s; 
            background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
        }
        .flying-card:nth-child(2) { 
            animation-delay: 0.3s; 
            background: linear-gradient(135deg, #4ecdc4, #2a9d8f);
        }
        .flying-card:nth-child(3) { 
            animation-delay: 0.5s; 
            background: linear-gradient(135deg, #ffd166, #ff9e66);
        }
        .flying-card:nth-child(4) { 
            animation-delay: 0.7s; 
            background: linear-gradient(135deg, #a8e6cf, #88d1a5);
        }
        .flying-card:nth-child(5) { 
            animation-delay: 0.9s; 
            background: linear-gradient(135deg, #d4a5ff, #b388fe);
        }
        .flying-card:nth-child(6) { 
            animation-delay: 1.1s; 
            background: linear-gradient(135deg, #ff9e6b, #ff7b54);
        }
        .flying-card:nth-child(7) { 
            animation-delay: 1.3s; 
            background: linear-gradient(135deg, #6bcaff, #54a0ff);
        }
        .flying-card:nth-child(8) { 
            animation-delay: 1.5s; 
            background: linear-gradient(135deg, #ff6bc9, #ff54a8);
        }
        .flying-card:nth-child(9) { 
            animation-delay: 1.7s; 
            background: linear-gradient(135deg, #6bffb8, #54ff9d);
        }

        /* Updated keyframes for full screen rotation */
        @keyframes flyAroundScreen {
            0% {
                opacity: 0;
                transform: 
                    translateX(0) 
                    translateY(0) 
                    rotate(0deg) 
                    scale(0.5);
            }
            10% {
                opacity: 1;
            }
            100% {
                opacity: 1;
                transform: 
                    translateX(var(--tx, 0)) 
                    translateY(var(--ty, 0)) 
                    rotate(var(--rot, 360deg)) 
                    scale(1);
            }
        }

        /* Sparkle Effects */
        .sparkle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: gold;
            border-radius: 50%;
            pointer-events: none;
            opacity: 0;
            animation: sparkle 1s ease-out forwards;
        }

        @keyframes sparkle {
            0% {
                opacity: 1;
                transform: scale(0);
            }
            50% {
                opacity: 1;
                transform: scale(1);
            }
            100% {
                opacity: 0;
                transform: scale(0);
            }
        }

        /* Secret Santa Admin Panel Styles */
        .secret-santa-admin {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #ffd166;
        }

        .secret-santa-admin h4 {
            color: #ffd166;
            margin-bottom: 15px;
            text-align: center;
        }

        .admin-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .assignments-display {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .assignment-stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .assignment-stats .stat {
            text-align: center;
            min-width: 120px;
        }

        .assignment-stats .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #4ecdc4;
        }

        .assignment-stats .stat-label {
            font-size: 0.8rem;
            color: #aaa;
        }

        .assignments-list {
            max-height: 400px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 10px;
        }

        .assignment-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            margin: 8px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            border-left: 4px solid #4ecdc4;
            transition: all 0.3s ease;
        }

        .assignment-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(5px);
        }

        .assignment-item.duplicate {
            border-left-color: #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
        }

        .assignment-item.self-assigned {
            border-left-color: #ffd166;
            background: rgba(255, 209, 102, 0.1);
        }

        .player-info {
            display: flex;
            flex-direction: column;
            flex: 1;
        }

        .player-number {
            font-weight: bold;
            color: #ffd166;
            font-size: 1.1rem;
        }

        .player-assignment {
            color: #4ecdc4;
            font-size: 0.9rem;
            margin-top: 4px;
        }

        .player-name {
            color: #aaa;
            font-size: 0.8rem;
            margin-top: 2px;
            font-style: italic;
        }

        .validation-results {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            border-left: 4px solid #4ecdc4;
        }

        .validation-results.warning {
            border-left-color: #ffd166;
            background: rgba(255, 209, 102, 0.1);
        }

        .validation-results.error {
            border-left-color: #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
        }

        .validation-item {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .validation-item:last-child {
            border-bottom: none;
        }

        .validation-good {
            color: #4ecdc4;
        }

        .validation-warning {
            color: #ffd166;
        }

        .validation-error {
            color: #ff6b6b;
        }

        .export-options {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
        }

        .export-btn {
            padding: 8px 15px;
            background: rgba(78, 205, 196, 0.3);
            border: 1px solid #4ecdc4;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .export-btn:hover {
            background: rgba(78, 205, 196, 0.5);
        }

        /* Center the Simpson GIF */
        .funny-gif {
            display: block;
            margin: 20px auto;
            max-width: 300px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .survey-options {
                flex-direction: column;
                align-items: center;
            }
            
            .option-card {
                width: 100%;
                max-width: 300px;
            }
            
            .game-stats {
                flex-direction: column;
                gap: 10px;
            }
            
            .quote-options {
                grid-template-columns: 1fr;
            }
            
            .music-controls {
                flex-wrap: wrap;
            }
            
            .global-music-controls {
                display: none;
            }
            
            .volume-slider {
                display: none;
            }
            
            .wordle-cell {
                width: 50px;
                height: 50px;
                font-size: 1.5rem;
            }
            
            .wordle-input {
                width: 150px;
            }
            
            .music-player-btn {
                display: none;
            }

            /* Mobile adjustments for new card design */
            .pokemon-tcg-card {
                width: 320px;
                height: 480px;
                padding: 12px;
            }
            
            .card-header {
                min-height: 65px;
                padding: 10px 12px;
            }
            
            .card-title {
                font-size: 1.4rem;
                max-width: 65%;
            }
            
            .card-art-container {
                height: 280px; /* Adjusted for mobile */
            }
            
            .pokemon-art {
                max-width: 240px; /* Adjusted for mobile */
                max-height: 240px; /* Adjusted for mobile */
            }
            
            .card-hp {
                font-size: 1.1rem;
            }
            
            .carousel-container {
                height: 450px;
            }
            
            .carousel-nav {
                flex-direction: column;
                align-items: center;
            }
            
            .carousel-btn {
                width: 200px;
            }

            .tcg-pack {
                width: 250px;
                height: 350px;
            }
            
            .pokemon-pack-art {
                font-size: 6rem;
            }
            
            .flying-card {
                width: 150px;
                height: 210px;
                font-size: 2rem;
            }

            .admin-controls {
                flex-direction: column;
                align-items: center;
            }
            
            .assignment-stats {
                flex-direction: column;
                gap: 15px;
            }
            
            .assignment-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .export-options {
                flex-direction: column;
                align-items: center;
            }
        }

        /* Fun GIF Styles */
        .funny-gif {
            max-width: 300px;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéÑ Secret Christmas Party üéÑ</h1>
            <p class="subtitle">You've been invited to a mysterious holiday gathering!</p>
        </header>
        
        <!-- Public Results Screen -->
        <div id="publicResultsScreen" class="screen">
            <h2>üéÑ Current Party Voting Results</h2>
            <p>Live anonymous results - updated in real-time</p>
            
            <div class="anonymous-results">
                <div class="results-category">
                    <h4>üìÖ Date Preferences (Points + Budget)</h4>
                    <div id="publicDateResults"></div>
                </div>
                <div class="results-category">
                    <h4>‚è∞ Duration Preferences</h4>
                    <div id="publicDurationResults"></div>
                </div>
                <div class="results-category">
                    <h4>üìç Location Preferences</h4>
                    <div id="publicLocationResults"></div>
                </div>
                <div class="results-category">
                    <h4>üëï Attire Preferences</h4>
                    <div id="publicAttireResults"></div>
                </div>
                <div class="results-category">
                    <h4>üåô Moonshine Preferences</h4>
                    <div id="publicMoonshineResults"></div>
                </div>
                <div class="results-category">
                    <h4>üéØ Activity Preferences</h4>
                    <div id="publicActivityResults"></div>
                </div>
            </div>
            
            <div class="instructions">
                <p>These results update automatically as people vote</p>
                <p>Total voters: <span id="publicTotalVoters">0</span></p>
            </div>
            
            <button class="btn" onclick="showScreen('invitationScreen')">Cast Your Vote</button>
            <button class="btn btn-secondary" onclick="location.reload()">Refresh Results</button>
        </div>
        
        <!-- Already Submitted Screen -->
        <div id="alreadySubmittedScreen" class="screen">
            <div class="already-submitted">
                <h3>You've Already Submitted Your Preferences!</h3>
                <p>It looks like you've already voted for the Christmas party. We appreciate your input!</p>
                <p>You can still view the current results or invite a friend to participate.</p>
                <button class="btn" id="viewResultsBtn">View Current Results</button>
                <button class="btn btn-secondary" id="inviteFriendBtn">Invite a Friend</button>
                <!-- Admin-only reset button (hidden by default) -->
                <button class="btn btn-admin hidden" id="adminResetBtn">Admin: Reset All Data</button>
            </div>
        </div>
        
        <!-- Invitation Screen -->
        <div id="invitationScreen" class="screen active">
            <div class="invitation-card">
                <h2>You're Invited!</h2>
                <p>A secret Christmas party is being planned for December, and your presence is requested!</p>
                <p>Help decide the date by voting anonymously and playing our Christmas games.</p>
                <p>No one will know who's coming until the final reveal on December 1st!</p>
                <!-- Simpson GIF kept as requested -->
                <div style="display: flex; justify-content: center; margin: 20px 0;">
                    <img src="https://media.giphy.com/media/xT5LMHxhOfscxPfIfm/giphy.gif" alt="Christmas GIF" class="funny-gif">
                </div>
                <button class="btn" id="acceptBtn">Accept Invitation</button>
            </div>
        </div>
        
        <!-- Rest of the screens remain the same -->
        <!-- Date Preference Screen -->
        <div id="dateScreen" class="screen">
            <h2>Choose Your Preferred Weekend</h2>
            <p>Select which December weekend works best for you:</p>
            
            <div class="survey-options">
                <div class="option-card" data-date="dec-1">
                    <div class="option-title">December 7-9</div>
                    <div class="option-desc">Friday to Sunday (3 days)</div>
                </div>
                <div class="option-card" data-date="dec-2">
                    <div class="option-title">December 14-16</div>
                    <div class="option-desc">Friday to Sunday (3 days)</div>
                </div>
                <div class="option-card" data-date="dec-3">
                    <div class="option-title">December 21-23</div>
                    <div class="option-desc">Friday to Sunday (3 days)</div>
                </div>
                <div class="option-card" data-date="dec-4">
                    <div class="option-title">December 27-28</div>
                    <div class="option-desc">Friday to Saturday (2 days)</div>
                </div>
            </div>
            
            <button class="btn" id="dateNextBtn" disabled>Next</button>
        </div>
        
        <!-- Duration Preference Screen -->
        <div id="durationScreen" class="screen">
            <h2>How Many Days Should The Party Be?</h2>
            <p>Select your preferred duration:</p>
            
            <div class="survey-options">
                <div class="option-card" data-duration="fri-sun">
                    <div class="option-title">3 Days</div>
                    <div class="option-desc">Friday to Sunday</div>
                </div>
                <div class="option-card" data-duration="sat-sun">
                    <div class="option-title">2 Days</div>
                    <div class="option-desc">Saturday & Sunday</div>
                </div>
                <div class="option-card" data-duration="sat-only">
                    <div class="option-title">Saturday Only</div>
                    <div class="option-desc">One day event</div>
                </div>
                <div class="option-card" data-duration="sun-only">
                    <div class="option-title">Sunday Only</div>
                    <div class="option-desc">One day event</div>
                </div>
            </div>
            
            <button class="btn" id="durationNextBtn" disabled>Next</button>
        </div>
        
        <!-- Activity Preference Screen -->
        <div id="activityScreen" class="screen">
            <h2>Preferred Party Activities</h2>
            <p>What activities would you like to do during the party?</p>
            
            <div class="survey-options">
                <div class="option-card" data-activity="skating">
                    <div class="option-icon">‚õ∏Ô∏è</div>
                    <div class="option-title">Ice Skating</div>
                </div>
                <div class="option-card" data-activity="k1-speed">
                    <div class="option-icon">üèéÔ∏è</div>
                    <div class="option-title">K1 Speed Go Kart</div>
                </div>
                <div class="option-card" data-activity="kickball-soccer">
                    <div class="option-icon">‚öΩ</div>
                    <div class="option-title">Kickball & Soccer</div>
                </div>
                <div class="option-card" data-activity="hiking">
                    <div class="option-icon">ü•æ</div>
                    <div class="option-title">Winter Hiking</div>
                </div>
            </div>
            
            <button class="btn" id="activityNextBtn" disabled>Next</button>
        </div>
        
        <!-- Location Preference Screen -->
        <div id="locationScreen" class="screen">
            <h2>Preferred Party Location</h2>
            <p>Where would you like the party to be held?</p>
            
            <div class="survey-options">
                <div class="option-card" data-location="seattle">
                    <div class="option-icon">üå≤</div>
                    <div class="option-title">Seattle</div>
                    <div class="option-desc">(Flight not included)</div>
                </div>
                <div class="option-card" data-location="taiwan">
                    <div class="option-icon">üèÆ</div>
                    <div class="option-title">Taiwan</div>
                    <div class="option-desc">(Flight not included)</div>
                </div>
                <div class="option-card" data-location="hamilton">
                    <div class="option-icon">üèûÔ∏è</div>
                    <div class="option-title">Hamilton</div>
                </div>
                <div class="option-card" data-location="north-york">
                    <div class="option-icon">üèôÔ∏è</div>
                    <div class="option-title">North York</div>
                </div>
                <div class="option-card" data-location="mississauga">
                    <div class="option-icon">üé°</div>
                    <div class="option-title">Mississauga</div>
                </div>
            </div>
            
            <button class="btn" id="locationNextBtn" disabled>Next</button>
        </div>
        
        <!-- Attire Preference Screen -->
        <div id="attireScreen" class="screen">
            <h2>Christmas Party Attire</h2>
            <p>What should everyone wear to the party?</p>
            
            <div class="survey-options">
                <div class="option-card" data-attire="pajamas">
                    <div class="option-icon">üõèÔ∏è</div>
                    <div class="option-title">Christmas Pajamas</div>
                </div>
                <div class="option-card" data-attire="ugly-sweater">
                    <div class="option-icon">üéÑ</div>
                    <div class="option-title">Ugly Christmas Sweater</div>
                </div>
                <div class="option-card" data-attire="formal">
                    <div class="option-icon">üëî</div>
                    <div class="option-title">Festive Formal</div>
                </div>
                <div class="option-card" data-attire="casual">
                    <div class="option-icon">üëï</div>
                    <div class="option-title">Casual Christmas</div>
                </div>
            </div>
            
            <button class="btn" id="attireNextBtn" disabled>Next</button>
        </div>

        <!-- Budget Allocation Screen -->
        <div id="budgetScreen" class="screen">
            <h2>Budget Allocation</h2>
            <p>Distribute your budget across the dates to show your preference:</p>
            <p class="instructions">You can allocate up to $100 for each date independently.</p>
            
            <div class="budget-section">
                <div class="budget-header">
                    <h3>Your Budget: Up to $100 per date</h3>
                </div>
                
                <div class="budget-option">
                    <div class="budget-label">
                        <span>December 7-9</span>
                        <span class="budget-amount" id="budgetDec1Amount">$0</span>
                    </div>
                    <input type="range" class="budget-slider" id="budgetDec1" min="0" max="100" value="0">
                </div>
                
                <div class="budget-option">
                    <div class="budget-label">
                        <span>December 14-16</span>
                        <span class="budget-amount" id="budgetDec2Amount">$0</span>
                    </div>
                    <input type="range" class="budget-slider" id="budgetDec2" min="0" max="100" value="0">
                </div>
                
                <div class="budget-option">
                    <div class="budget-label">
                        <span>December 21-23</span>
                        <span class="budget-amount" id="budgetDec3Amount">$0</span>
                    </div>
                    <input type="range" class="budget-slider" id="budgetDec3" min="0" max="100" value="0">
                </div>
                
                <div class="budget-option">
                    <div class="budget-label">
                        <span>December 27-28</span>
                        <span class="budget-amount" id="budgetDec4Amount">$0</span>
                    </div>
                    <input type="range" class="budget-slider" id="budgetDec4" min="0" max="100" value="0">
                </div>
                
                <div class="budget-remaining" id="budgetRemaining">
                    No budget limit - allocate up to $100 for each date
                </div>
            </div>
            
            <button class="btn" id="budgetNextBtn">Next</button>
        </div>

        <!-- Moonshine Survey Screen -->
        <div id="moonshineScreen" class="screen">
            <h2>üåô The Important Questions üåô</h2>
            <p>Help us plan the party essentials!</p>
            
            <div class="form-group">
                <label for="moonshineSelect">Are you drinking moonshine?</label>
                <select id="moonshineSelect">
                    <option value="">Select an option</option>
                    <option value="yes">Yes</option>
                    <option value="no">No</option>
                    <option value="maybe">Maybe</option>
                </select>
            </div>
            
            <button class="btn" id="moonshineNextBtn" disabled>Next</button>
        </div>
        
        <!-- Christmas Quote Game Screen -->
        <div id="quoteGameScreen" class="screen">
            <h2>Christmas Quote Challenge</h2>
            <p>Guess which Christmas movie this quote is from to earn bonus points!</p>
            
            <div class="quote-game">
                <div class="quote-text" id="quoteText">"Every time a bell rings, an angel gets his wings."</div>
                
                <div class="quote-options" id="quoteOptions">
                    <!-- Options will be filled by JavaScript -->
                </div>
                
                <div class="game-stats">
                    <div class="stat">
                        <div class="stat-value" id="quoteScore">0</div>
                        <div class="stat-label">QUOTE POINTS</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="quoteProgress">1/5</div>
                        <div class="stat-label">PROGRESS</div>
                    </div>
                </div>
            </div>
            
            <button class="btn hidden" id="quoteNextBtn">Next Quote</button>
            <button class="btn hidden" id="quoteGameNextBtn">Continue to Next Game</button>
        </div>
        
        <!-- League of Legends Quote Game Screen -->
        <div id="lolGameScreen" class="screen">
            <h2>League of Legends Champion Quotes</h2>
            <p>Guess which champion says this quote to earn bonus points!</p>
            
            <div class="quote-game">
                <div class="quote-text" id="lolQuoteText">"The unseen blade is the deadliest."</div>
                
                <div class="quote-options" id="lolQuoteOptions">
                    <!-- Options will be filled by JavaScript -->
                </div>
                
                <div class="game-stats">
                    <div class="stat">
                        <div class="stat-value" id="lolQuoteScore">0</div>
                        <div class="stat-label">LOL POINTS</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="lolQuoteProgress">1/5</div>
                        <div class="stat-label">PROGRESS</div>
                    </div>
                </div>
            </div>
            
            <button class="btn hidden" id="lolQuoteNextBtn">Next Quote</button>
            <button class="btn hidden" id="lolGameNextBtn">Continue to Next Game</button>
        </div>
        
        <!-- Christmas Song Game Screen -->
        <div id="songGameScreen" class="screen">
            <h2>üéµ Christmas Song Guessing Game üéµ</h2>
            <p>Guess the Christmas song from the lyrics to earn bonus points!</p>
            
            <div class="song-game">
                <div class="song-lyrics" id="songLyricsText">Lyrics will appear here</div>
                
                <input type="text" class="song-input" id="songInput" placeholder="Type your guess here...">
                
                <div class="song-feedback" id="songFeedback"></div>
                
                <div class="game-stats">
                    <div class="stat">
                        <div class="stat-value" id="songScore">0</div>
                        <div class="stat-label">SONG POINTS</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="songProgress">1/8</div>
                        <div class="stat-label">PROGRESS</div>
                    </div>
                </div>
            </div>
            
            <button class="btn" id="songSubmitBtn">Submit Guess</button>
            <button class="btn hidden" id="songNextBtn">Next Song</button>
            <button class="btn hidden" id="songGameNextBtn">Continue to Next Game</button>
        </div>

        <!-- Wordle Game Screen -->
        <div id="wordleGameScreen" class="screen">
            <h2>Christmas Wordle Challenge</h2>
            <p>Guess the 5-letter word! You have 5 attempts. No hints given! üéÑ</p>
            
            <div class="wordle-game">
                <div class="wordle-grid" id="wordleGrid">
                    <!-- Wordle grid will be generated by JavaScript -->
                </div>
                
                <div class="wordle-input-container">
                    <input type="text" id="wordleInput" maxlength="5" placeholder="Enter 5-letter word" class="wordle-input">
                    <button class="btn" id="wordleGuessBtn">Guess</button>
                </div>
                
                <div class="wordle-complete hidden" id="wordleCompleteMessage">
                    <h3>Wordle Complete!</h3>
                    <p id="wordleResultMessage"></p>
                </div>
                
                <div class="game-stats">
                    <div class="stat">
                        <div class="stat-value" id="wordleScore">0</div>
                        <div class="stat-label">WORDLE POINTS</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="wordleAttempts">5</div>
                        <div class="stat-label">ATTEMPTS LEFT</div>
                    </div>
                </div>
            </div>
            
            <button class="btn hidden" id="wordleNextBtn">Continue to Next Game</button>
        </div>
        
        <!-- Game Screen -->
        <div id="gameScreen" class="screen">
            <h2>Christmas Aim Trainer</h2>
            <p>Shoot snowmen to earn points for your preferred date!</p>
            <p>The more points you earn, the higher chance your preferred date gets selected!</p>
            
            <div class="hit-area-info">
                <p><span class="highlight">NEW:</span> You can now click anywhere on the snowman - head, body, or bottom!</p>
                <div class="snowman-example">
                    <div class="snowman-demo">
                        <div class="snowman-body"></div>
                        <div class="snowman-middle"></div>
                        <div class="snowman-head"></div>
                        <div class="hit-area"></div>
                    </div>
                </div>
                <p>The dashed red line shows the clickable area</p>
            </div>
            
            <div class="game-stats">
                <div class="stat">
                    <div class="stat-value" id="scoreDisplay">0</div>
                    <div class="stat-label">POINTS</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="timeDisplay">60</div>
                    <div class="stat-label">SECONDS</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="targetsDisplay">0</div>
                    <div class="stat-label">SNOWMEN HIT</div>
                </div>
            </div>
            
            <div class="game-area">
                <canvas id="gameCanvas" width="800" height="500"></canvas>
            </div>
            
            <div class="instructions">
                <p>Click on the snowmen to earn points! You have 60 seconds.</p>
                <p><strong>Click anywhere on the snowman - head, body, or bottom - to hit it!</strong></p>
                <p><strong>You must complete this game to continue!</strong></p>
            </div>
            
            <button class="btn" id="startGameBtn">Start Game</button>
            <button class="btn btn-secondary hidden" id="gameNextBtn">Continue</button>
        </div>
        
        <!-- Pok√©mon Game Screen -->
        <div id="pokemonGameScreen" class="screen">
            <h2>Who's That Pok√©mon?</h2>
            <p>Identify the Pok√©mon from its silhouette to earn bonus points!</p>
            
            <div class="pokemon-game">
                <div class="pokemon-image-container">
                    <img id="pokemonImage" class="pokemon-silhouette" src="" alt="Pok√©mon Silhouette">
                </div>
                
                <div class="pokemon-options" id="pokemonOptions">
                    <!-- Options will be filled by JavaScript -->
                </div>
                
                <div class="game-stats">
                    <div class="stat">
                        <div class="stat-value" id="pokemonScore">0</div>
                        <div class="stat-label">POK√âMON POINTS</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="pokemonProgress">1/5</div>
                        <div class="stat-label">PROGRESS</div>
                    </div>
                </div>
            </div>
            
            <button class="btn hidden" id="pokemonNextBtn">Next Pok√©mon</button>
            <button class="btn hidden" id="pokemonGameNextBtn">Continue to Secret Santa</button>
        </div>
        
        <!-- Pok√©mon TCG Pack Opening Screen - UPDATED -->
        <div id="secretSantaScreen" class="screen secret-santa-screen">
            <h2>üéÅ Pok√©mon TCG Secret Santa Pack üéÅ</h2>
            <p>Click the pack to open it and reveal your 9 Pok√©mon cards including your Secret Santa assignment!</p>
            
            <!-- MOVED: Gift Rules to top section -->
            <div class="gift-rules">
                <h3>Gift Rules:</h3>
                <ul>
                    <li>Unisex gifts only (should appeal to anyone)</li>
                    <li>No gift cards allowed</li>
                    <li>Gifts should be thoughtful and fun!</li>
                    <li>Budget: $20-30</li>
                </ul>
            </div>

            <!-- Pack Opening Container - MOVED CAROUSEL HERE -->
            <div class="pack-opening-container">
                <!-- Carousel (now positioned higher up) -->
                <div class="tcg-carousel hidden" id="tcgCarousel">
                    <div class="carousel-container" id="carouselContainer">
                        <div class="carousel-track" id="carouselTrack">
                            <!-- Cards will be dynamically generated here -->
                        </div>
                    </div>
                    
                    <div class="carousel-progress" id="carouselProgress">
                        <!-- Progress dots will be generated here -->
                    </div>
                    
                    <div class="carousel-instructions" id="carouselInstructions">
                        Use buttons or arrow keys to navigate through your cards
                    </div>
                    
                    <div class="carousel-nav">
                        <button class="carousel-btn prev" id="prevBtn" disabled>‚Üê Previous</button>
                        <button class="carousel-btn" id="nextBtn">Next Card ‚Üí</button>
                    </div>
                    
                    <div class="keyboard-hints">
                        Use ‚Üê ‚Üí arrow keys to navigate
                    </div>
                </div>

                <!-- Pok√©mon TCG Pack -->
                <div class="tcg-pack" id="tcgPack">
                    <div class="pack-front" id="packFront">
                        <div class="pack-art">
                            <div class="pokemon-pack-art">‚ú®</div>
                            <div class="energy-symbols">
                                <span class="energy energy-grass">üåø</span>
                                <span class="energy energy-fire">üî•</span>
                                <span class="energy energy-water">üíß</span>
                            </div>
                        </div>
                        <div class="pack-info">
                            <div class="pack-title">Secret Santa</div>
                            <div class="pack-subtitle">Holiday Edition</div>
                            <div class="pack-set">SS-EN001</div>
                        </div>
                        <div class="pack-flap"></div>
                    </div>
                </div>
                
                <div class="pack-instructions" id="packInstructions">
                    <p>Click the pack to open it!</p>
                </div>

                <!-- Cards that fly out when pack is opened -->
                <div class="cards-container hidden" id="cardsContainer">
                    <!-- Cards will be generated here -->
                </div>
            </div>
            
            <button class="btn hidden" id="secretSantaNextBtn">Continue to Registration</button>
        </div>
        
        <!-- Registration Screen -->
        <div id="registerScreen" class="screen">
            <h2>Almost Done!</h2>
            <p>Provide your details to be notified about the party date (your information will remain private):</p>
            
            <div class="form-group">
                <label for="nameInput">Your Name</label>
                <input type="text" id="nameInput" placeholder="Enter your name">
            </div>
            
            <div class="form-group">
                <label for="emailInput">Your Email</label>
                <input type="email" id="emailInput" placeholder="Enter your email">
            </div>
            
            <button class="btn" id="submitBtn">Submit</button>
        </div>
        
        <!-- Results Screen -->
        <div id="resultsScreen" class="screen">
            <h2>Thank You!</h2>
            <p>Your preferences have been recorded anonymously.</p>
            <p>The final party date will be announced on December 1st based on everyone's votes and game scores!</p>
            
            <div class="party-date" id="finalDateDisplay">Date will be announced December 1st</div>
            
            <div class="attendees-count" id="attendeesCount">
                Total attendees so far: <span id="totalAttendees">0</span>
            </div>
            
            <div class="email-notification" id="emailNotification">
                Your information has been saved to our secure database.
            </div>
            
            <!-- NEW: Anonymous Results Display -->
            <div class="anonymous-results" id="anonymousResults">
                <h3>üìä Current Anonymous Results</h3>
                
                <!-- Date Preferences -->
                <div class="results-category">
                    <h4>üéØ Date Preferences (Points + Budget)</h4>
                    <div id="dateResults">
                        <!-- Will be filled by JavaScript -->
                    </div>
                </div>
                
                <!-- Duration Preferences -->
                <div class="results-category">
                    <h4>‚è∞ Duration Preferences</h4>
                    <div id="durationResults">
                        <!-- Will be filled by JavaScript -->
                    </div>
                </div>
                
                <!-- Activity Preferences -->
                <div class="results-category">
                    <h4>üéØ Activity Preferences</h4>
                    <div id="activityResults">
                        <!-- Will be filled by JavaScript -->
                    </div>
                </div>
                
                <!-- Location Preferences -->
                <div class="results-category">
                    <h4>üìç Location Preferences</h4>
                    <div id="locationResults">
                        <!-- Will be filled by JavaScript -->
                    </div>
                </div>
                
                <!-- Attire Preferences -->
                <div class="results-category">
                    <h4>üëï Attire Preferences</h4>
                    <div id="attireResults">
                        <!-- Will be filled by JavaScript -->
                    </div>
                </div>
                
                <!-- Moonshine Preferences -->
                <div class="results-category">
                    <h4>üåô Moonshine Preferences</h4>
                    <div id="moonshineResults">
                        <!-- Will be filled by JavaScript -->
                    </div>
                </div>
                
                <div class="results-note">
                    <p>All results are completely anonymous - no individual votes are shown</p>
                </div>
            </div>
            
            <!-- Admin Section (Only visible to you) -->
            <div class="admin-section hidden" id="adminSection">
                <h3>üéÖ Admin Controls</h3>
                <p>Send December 1st notifications to all voters:</p>
                <button class="btn btn-admin" id="sendNotificationsBtn">
                    Send December 1st Notifications
                </button>
                
                <!-- NEW: Secret Santa Admin Panel -->
                <div class="secret-santa-admin">
                    <h4>üéÅ Secret Santa Assignments</h4>
                    <div class="admin-controls">
                        <button class="btn btn-admin" id="viewAssignmentsBtn">View All Assignments</button>
                        <button class="btn btn-admin" id="exportAssignmentsBtn">Export to CSV</button>
                        <button class="btn btn-admin" id="validateAssignmentsBtn">Validate Assignments</button>
                        <button class="btn btn-admin" id="fixAssignmentsBtn">Fix Self-Assignments</button>
                    </div>
                    
                    <div id="assignmentsDisplay" class="assignments-display hidden">
                        <div class="assignment-stats">
                            <div class="stat">
                                <div class="stat-value" id="totalPlayers">0</div>
                                <div class="stat-label">TOTAL PLAYERS</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value" id="assignedPlayers">0</div>
                                <div class="stat-label">ASSIGNED</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value" id="uniqueAssignments">0</div>
                                <div class="stat-label">UNIQUE ASSIGNMENTS</div>
                            </div>
                        </div>
                        
                        <div class="assignments-list" id="assignmentsList">
                            <!-- Assignment list will be populated here -->
                        </div>
                        
                        <div id="validationResults" class="validation-results hidden">
                            <!-- Validation results will be shown here -->
                        </div>
                    </div>
                </div>
                
                <div id="adminStatus" class="instructions" style="margin-top: 10px;"></div>
            </div>
            
            <p class="instructions">No one will know who is attending until the party date is announced!</p>
            
            <button class="btn" id="restartBtn">Invite a Friend</button>
        </div>
        
        <footer>
            <p>Secret Christmas Party Invitation | All information is stored securely in our database</p>
        </footer>
    </div>

    <script>
        // JSONBin.io Configuration - CORRECTED
        const JSONBIN_CONFIG = {
            BIN_ID: "69259faa6bea881f46fe4a2", // Your actual Bin ID
            API_KEY: "$2a$10$nQR/dub.BVjVpPzXbkRSXuS8kdYXN849fP6SWUFB1mRf0XJjab8lC",
            BASE_URL: "https://api.jsonbin.io/v3/b"
        };
// EmailJS Configuration
const EMAILJS_CONFIG = {
    SERVICE_ID: "service_ll1m927",
    TEMPLATE_SECRET_SANTA: "secret_santa_assignment",
    TEMPLATE_DECEMBER_1ST: "december_1st_announcement",
    TEMPLATE_NEW_VOTER: "new_voter_notification",
    ADMIN_EMAIL: "Rosariolore59@gmail.com"
};

// EmailJS Functions
async function sendSecretSantaEmail(playerEmail, playerName, playerNumber, targetPlayerNumber, giftSuggestion) {
    try {
        const templateParams = {
            to_email: playerEmail,
            to_name: playerName,
            player_number: playerNumber,
            target_player_number: targetPlayerNumber,
            gift_suggestion: giftSuggestion,
            budget: "$20-30"
        };

        const response = await emailjs.send(
            EMAILJS_CONFIG.SERVICE_ID,
            EMAILJS_CONFIG.TEMPLATE_SECRET_SANTA,
            templateParams
        );

        console.log('‚úÖ Secret Santa email sent successfully:', response);
        return true;
    } catch (error) {
        console.error('‚ùå Error sending Secret Santa email:', error);
        return false;
    }
}

async function sendDecember1stEmail(voterEmail, voterName, partyDetails) {
    try {
        const templateParams = {
            to_email: voterEmail,
            to_name: voterName,
            party_date: partyDetails.date,
            location: partyDetails.location,
            duration: partyDetails.duration,
            attire: partyDetails.attire,
            activities: partyDetails.activities,
            total_attendees: partyDetails.totalAttendees
        };

        const response = await emailjs.send(
            EMAILJS_CONFIG.SERVICE_ID,
            EMAILJS_CONFIG.TEMPLATE_DECEMBER_1ST,
            templateParams
        );

        console.log('‚úÖ December 1st email sent successfully:', response);
        return true;
    } catch (error) {
        console.error('‚ùå Error sending December 1st email:', error);
        return false;
    }
}

async function sendNewVoterNotification(submission) {
    try {
        const totalScore = submission.gameScore + submission.quoteScore + 
                         submission.lolQuoteScore + submission.songScore + 
                         submission.wordleScore + submission.pokemonScore;

        const dateLabels = {
            'dec-1': 'December 7-9',
            'dec-2': 'December 14-16',
            'dec-3': 'December 21-23',
            'dec-4': 'December 27-28'
        };

        const durationLabels = {
            'fri-sun': '3 Days (Fri-Sun)',
            'sat-sun': '2 Days (Sat-Sun)',
            'sat-only': 'Saturday Only',
            'sun-only': 'Sunday Only'
        };

        const locationLabels = {
            'seattle': 'Seattle',
            'taiwan': 'Taiwan',
            'hamilton': 'Hamilton',
            'north-york': 'North York',
            'mississauga': 'Mississauga'
        };

        const attireLabels = {
            'pajamas': 'Christmas Pajamas',
            'ugly-sweater': 'Ugly Christmas Sweater',
            'formal': 'Festive Formal',
            'casual': 'Casual Christmas'
        };

        const activityLabels = {
            'skating': 'Ice Skating',
            'k1-speed': 'K1 Speed Go Kart',
            'kickball-soccer': 'Kickball & Soccer',
            'hiking': 'Winter Hiking'
        };

        const templateParams = {
            to_email: EMAILJS_CONFIG.ADMIN_EMAIL,
            from_name: submission.name,
            voter_email: submission.email,
            vote_date: new Date(submission.timestamp).toLocaleString(),
            preferred_date: dateLabels[submission.date] || submission.date,
            preferred_duration: durationLabels[submission.duration] || submission.duration,
            preferred_location: locationLabels[submission.location] || submission.location,
            preferred_attire: attireLabels[submission.attire] || submission.attire,
            preferred_activity: activityLabels[submission.activity] || submission.activity,
            moonshine_choice: submission.moonshine,
            aim_trainer: submission.gameScore,
            quotes: submission.quoteScore,
            lol_quotes: submission.lolQuoteScore,
            songs: submission.songScore,
            wordle: submission.wordleScore,
            pokemon: submission.pokemonScore,
            total_score: totalScore,
            total_voters: gameState.submissions.length
        };

        const response = await emailjs.send(
            EMAILJS_CONFIG.SERVICE_ID,
            EMAILJS_CONFIG.TEMPLATE_NEW_VOTER,
            templateParams
        );

        console.log('‚úÖ New voter notification sent successfully:', response);
        return true;
    } catch (error) {
        console.error('‚ùå Error sending new voter notification:', error);
        return false;
    }
}

async function sendAllDecember1stNotifications() {
    if (!gameState.submissions || gameState.submissions.length === 0) {
        alert('No voters to notify!');
        return;
    }

    const winningDate = Object.entries(gameState.votingData)
        .reduce((a, b) => (a[1].points + a[1].budget) > (b[1].points + b[1].budget) ? a : b)[0];
    
    const winningDuration = Object.entries(gameState.durationData)
        .reduce((a, b) => a[1].votes > b[1].votes ? a : b)[0];
    
    const winningLocation = Object.entries(gameState.locationData)
        .reduce((a, b) => a[1].votes > b[1].votes ? a : b)[0];
    
    const winningAttire = Object.entries(gameState.attireData)
        .reduce((a, b) => a[1].votes > b[1].votes ? a : b)[0];
    
    const winningActivity = Object.entries(gameState.activityData)
        .reduce((a, b) => a[1].votes > b[1].votes ? a : b)[0];

    const dateLabels = {
        'dec-1': 'December 7-9',
        'dec-2': 'December 14-16',
        'dec-3': 'December 21-23',
        'dec-4': 'December 27-28'
    };

    const durationLabels = {
        'fri-sun': '3 Days (Fri-Sun)',
        'sat-sun': '2 Days (Sat-Sun)',
        'sat-only': 'Saturday Only',
        'sun-only': 'Sunday Only'
    };

    const locationLabels = {
        'seattle': 'Seattle',
        'taiwan': 'Taiwan',
        'hamilton': 'Hamilton',
        'north-york': 'North York',
        'mississauga': 'Mississauga'
    };

    const attireLabels = {
        'pajamas': 'Christmas Pajamas',
        'ugly-sweater': 'Ugly Christmas Sweater',
        'formal': 'Festive Formal',
        'casual': 'Casual Christmas'
    };

    const activityLabels = {
        'skating': 'Ice Skating',
        'k1-speed': 'K1 Speed Go Kart',
        'kickball-soccer': 'Kickball & Soccer',
        'hiking': 'Winter Hiking'
    };

    const partyDetails = {
        date: dateLabels[winningDate],
        duration: durationLabels[winningDuration],
        location: locationLabels[winningLocation],
        attire: attireLabels[winningAttire],
        activities: activityLabels[winningActivity],
        totalAttendees: gameState.submissions.length
    };

    let successCount = 0;
    let failCount = 0;

    for (const submission of gameState.submissions) {
        const success = await sendDecember1stEmail(
            submission.email,
            submission.name,
            partyDetails
        );
        
        if (success) {
            successCount++;
        } else {
            failCount++;
        }

        await new Promise(resolve => setTimeout(resolve, 1000));
    }

    const statusMessage = `Sent ${successCount} emails successfully. ${failCount} failed.`;
    document.getElementById('adminStatus').textContent = statusMessage;
    alert(statusMessage);
}
        // Function to save data to JSONBin.io - FIXED
        async function saveToJSONBin(data) {
            try {
                console.log('üíæ Attempting to save data to JSONBin...', JSONBIN_CONFIG);
                
                const response = await fetch(`${JSONBIN_CONFIG.BASE_URL}/${JSONBIN_CONFIG.BIN_ID}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': JSONBIN_CONFIG.API_KEY,
                        'X-Bin-Versioning': 'false'
                    },
                    body: JSON.stringify(data)
                });
                
                console.log('üì° Response status:', response.status);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('‚ùå HTTP error details:', errorText);
                    throw new Error(`HTTP error! status: ${response.status}, details: ${errorText}`);
                }
                
                const result = await response.json();
                console.log('‚úÖ Data saved successfully to JSONBin:', result);
                return result;
            } catch (error) {
                console.error('‚ùå Error saving data to JSONBin:', error);
                // Don't throw error - continue with local storage as fallback
                console.log('üîÑ Falling back to local storage...');
                localStorage.setItem('christmasPartyData', JSON.stringify(data));
                return { success: false, error: error.message, usedLocalStorage: true };
            }
        }

        // Function to load data from JSONBin.io - FIXED
        async function loadFromJSONBin() {
            try {
                console.log('üì• Attempting to load data from JSONBin...', JSONBIN_CONFIG);
                
                const response = await fetch(`${JSONBIN_CONFIG.BASE_URL}/${JSONBIN_CONFIG.BIN_ID}/latest`, {
                    headers: {
                        'X-Master-Key': JSONBIN_CONFIG.API_KEY
                    }
                });
                
                console.log('üì° Response status:', response.status);
                
                if (!response.ok) {
                    if (response.status === 404) {
                        console.log('üì≠ Bin not found, creating new one...');
                        return getDefaultData();
                    }
                    const errorText = await response.text();
                    throw new Error(`HTTP error! status: ${response.status}, details: ${errorText}`);
                }
                
                const result = await response.json();
                console.log('‚úÖ Data loaded successfully from JSONBin:', result);
                return result.record;
            } catch (error) {
                console.error('‚ùå Error loading data from JSONBin:', error);
                
                // Try to load from local storage as fallback
                try {
                    const localData = localStorage.getItem('christmasPartyData');
                    if (localData) {
                        console.log('üîÑ Loaded data from local storage fallback');
                        return JSON.parse(localData);
                    }
                } catch (localError) {
                    console.error('‚ùå Error loading from local storage:', localError);
                }
                
                // Return default data if all else fails
                console.log('üîÑ Using default data structure');
                return getDefaultData();
            }
        }

        // Test function to verify JSONBin connection - IMPROVED
        async function testJSONBinConnection() {
            try {
                console.log('üîç Testing JSONBin connection...', JSONBIN_CONFIG);
                
                // First try to create/update the bin
                const testData = { 
                    test: true, 
                    timestamp: new Date().toISOString(),
                    message: "Connection test successful" 
                };
                
                const saveResult = await saveToJSONBin(testData);
                
                if (saveResult.usedLocalStorage) {
                    console.log('‚ö†Ô∏è JSONBin connection failed - using local storage fallback');
                    return false;
                }
                
                console.log('‚úÖ JSONBin connection successful!');
                return true;
            } catch (error) {
                console.error('‚ùå JSONBin connection test failed:', error);
                return false;
            }
        }

        // Default data structure
        function getDefaultData() {
            return {
                submissions: [],
                votingData: {
                    'dec-1': { points: 0, voters: 0, budget: 0 },
                    'dec-2': { points: 0, voters: 0, budget: 0 },
                    'dec-3': { points: 0, voters: 0, budget: 0 },
                    'dec-4': { points: 0, voters: 0, budget: 0 }
                },
                durationData: {
                    'fri-sun': { votes: 0, points: 0 },
                    'sat-sun': { votes: 0, points: 0 },
                    'sat-only': { votes: 0, points: 0 },
                    'sun-only': { votes: 0, points: 0 }
                },
                activityData: {
                    'skating': { votes: 0 },
                    'k1-speed': { votes: 0 },
                    'kickball-soccer': { votes: 0 },
                    'hiking': { votes: 0 }
                },
                locationData: {
                    'seattle': { votes: 0 },
                    'taiwan': { votes: 0 },
                    'hamilton': { votes: 0 },
                    'north-york': { votes: 0 },
                    'mississauga': { votes: 0 }
                },
                attireData: {
                    'pajamas': { votes: 0 },
                    'ugly-sweater': { votes: 0 },
                    'formal': { votes: 0 },
                    'casual': { votes: 0 }
                },
                moonshineData: {
                    'yes': { votes: 0 },
                    'no': { votes: 0 },
                    'maybe': { votes: 0 }
                },
                budgetData: {
                    'dec-1': 0,
                    'dec-2': 0,
                    'dec-3': 0,
                    'dec-4': 0
                },
                secretSantaAssignments: {},
                playerNumbers: [],
                lastUpdated: new Date().toISOString()
            };
        }

        // Game State
        const gameState = {
            currentScreen: 'invitation',
            selectedDate: null,
            selectedDuration: null,
            selectedActivity: null,
            selectedLocation: null,
            selectedAttire: null,
            moonshineChoice: null,
            budgetAllocation: {
                'dec-1': 0,
                'dec-2': 0,
                'dec-3': 0,
                'dec-4': 0
            },
            gameScore: 0,
            targetsHit: 0,
            gameTime: 60,
            isGameRunning: false,
            gameTimer: null,
            playerName: '',
            playerEmail: '',
            quoteScore: 0,
            lolQuoteScore: 0,
            songScore: 0,
            wordleScore: 0,
            pokemonScore: 0,
            currentQuoteIndex: 0,
            currentLolQuoteIndex: 0,
            currentSongIndex: 0,
            currentPokemonIndex: 0,
            wordleAttempts: 5,
            wordleGuesses: [],
            playerId: null,
            wordleWord: '',
            wordleComplete: false,
            // Store data from JSONBin
            votingData: {},
            durationData: {},
            activityData: {},
            locationData: {},
            attireData: {},
            moonshineData: {},
            budgetData: {},
            submissions: [],
            secretSantaAssignments: {},
            playerNumbers: [],
            // Targets positions for aim trainer
            targets: [],
            // Admin mode
            isAdmin: false,
            // Track if user has interacted with the page
            userInteracted: false
        };

        // Game Data (your existing game data remains the same)
        const christmasQuotes = [
            {
                quote: "Every time a bell rings, an angel gets his wings.",
                options: ["It's a Wonderful Life", "A Christmas Carol", "Miracle on 34th Street", "Home Alone"],
                correct: 0
            },
            {
                quote: "Seeing isn't believing. Believing is seeing.",
                options: ["The Santa Clause", "The Polar Express", "Elf", "A Christmas Story"],
                correct: 1
            },
            {
                quote: "The best way to spread Christmas cheer is singing loud for all to hear.",
                options: ["Elf", "The Grinch", "Home Alone", "Love Actually"],
                correct: 0
            },
            {
                quote: "I will honour Christmas in my heart, and try to keep it all the year.",
                options: ["A Christmas Carol", "It's a Wonderful Life", "The Nightmare Before Christmas", "National Lampoon's Christmas Vacation"],
                correct: 0
            },
            {
                quote: "Christmas isn't just a day, it's a frame of mind.",
                options: ["Miracle on 34th Street", "The Santa Clause", "Home Alone 2", "The Holiday"],
                correct: 0
            }
        ];

        const lolQuotes = [
            {
                quote: "The unseen blade is the deadliest.",
                options: ["Zed", "Katarina", "Akali", "Talon"],
                correct: 0
            },
            {
                quote: "Okay.",
                options: ["Rammus", "Blitzcrank", "Amumu", "Malphite"],
                correct: 0
            },
            {
                quote: "Demacia!",
                options: ["Garen", "Lux", "Jarvan IV", "Fiora"],
                correct: 0
            },
            {
                quote: "Time to feast!",
                options: ["Kha'Zix", "Cho'Gath", "Rengar", "Warwick"],
                correct: 1
            },
            {
                quote: "Let me guide you.",
                options: ["Soraka", "Sona", "Janna", "Lulu"],
                correct: 0
            }
        ];

        // Christmas Song Game Data
        const christmasSongs = [
            {
                title: "Jingle Bells",
                lyrics: "Dashing through the snow, in a one-horse open sleigh"
            },
            {
                title: "Silent Night",
                lyrics: "Silent night, holy night, all is calm, all is bright"
            },
            {
                title: "Deck the Halls",
                lyrics: "Deck the halls with boughs of holly, fa-la-la-la-la, la-la-la-la"
            },
            {
                title: "We Wish You a Merry Christmas",
                lyrics: "We wish you a Merry Christmas, we wish you a Merry Christmas"
            },
            {
                title: "Rudolph the Red-Nosed Reindeer",
                lyrics: "Rudolph the red-nosed reindeer had a very shiny nose"
            },
            {
                title: "Santa Claus is Coming to Town",
                lyrics: "You better watch out, you better not cry, better not pout, I'm telling you why"
            },
            {
                title: "Frosty the Snowman",
                lyrics: "Frosty the snowman was a jolly happy soul"
            },
            {
                title: "Let It Snow",
                lyrics: "Oh the weather outside is frightful, but the fire is so delightful"
            }
        ];

        // FIXED: Wordle words - removed "SLEIGH" and added proper 5-letter words
        const wordleWords = ["SANTA", "MERRY", "GIFTS", "JOLLY", "SNOWY", "HOLLY", "PEACE", "CHEER"];

        // Pok√©mon Data for "Who's That Pok√©mon?" game
        const pokemonData = [
            {
                name: "Pikachu",
                image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/25.png",
                options: ["Pikachu", "Raichu", "Pichu", "Emolga"],
                correct: 0
            },
            {
                name: "Charizard",
                image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/6.png",
                options: ["Charizard", "Dragonite", "Salamence", "Garchomp"],
                correct: 0
            },
            {
                name: "Bulbasaur",
                image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/1.png",
                options: ["Bulbasaur", "Ivysaur", "Chikorita", "Treecko"],
                correct: 0
            },
            {
                name: "Squirtle",
                image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/7.png",
                options: ["Squirtle", "Wartortle", "Totodile", "Mudkip"],
                correct: 0
            },
            {
                name: "Jigglypuff",
                image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/39.png",
                options: ["Jigglypuff", "Clefairy", "Igglybuff", "Togepi"],
                correct: 0
            }
        ];

        // Pok√©mon TCG Data - UPDATED WITH ANIMATED GIFS
        const pokemonTCGData = {
            pokemonCards: [
                {
                    name: "Pikachu",
                    type: "Electric",
                    hp: 60,
                    attacks: [
                        { name: "Quick Attack", damage: 10 },
                        { name: "Thunderbolt", damage: 50 }
                    ],
                    weakness: "Fighting",
                    resistance: "None",
                    rarity: "Common",
                    image: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExaGM1a2hwbzdoZ2xjbWsxd3dxODZmaHJ3OGVlZ2cxMm01eWN3a2I3eSZlcD12MV9naWZzX3NlYXJjaCZjdD1n/U2nN0ridM4lXy/giphy.gif",
                    description: "A mouse Pok√©mon that stores electricity in its cheeks. When several of these Pok√©mon gather, their electricity could build and cause lightning storms."
                },
                {
                    name: "Charizard",
                    type: "Fire",
                    hp: 120,
                    attacks: [
                        { name: "Flamethrower", damage: 90 },
                        { name: "Fire Spin", damage: 40 }
                    ],
                    weakness: "Water",
                    resistance: "Fighting",
                    rarity: "Rare",
                    image: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExbXY2d3QzaDd5MzhtNHJvcm5lanZwZ2F5NWhoaW5ybXI1MXNrNDAxcSZlcD12MV9naWZzX3NlYXJjaCZjdD1n/6nWT5GyxsmAoM/giphy.gif",
                    description: "A dragon Pok√©mon that breathes fire hot enough to melt boulders. Known to cause forest fires unintentionally."
                },
                {
                    name: "Blastoise",
                    type: "Water",
                    hp: 100,
                    attacks: [
                        { name: "Hydro Pump", damage: 80 },
                        { name: "Skull Bash", damage: 30 }
                    ],
                    weakness: "Electric",
                    resistance: "None",
                    rarity: "Rare",
                    image: "https://media.giphy.com/media/v1.Y2lkPWVjZjA1ZTQ3ZzNwYjB5OWxiMm53NGNsNWV0aWtrejU1eDEydGFldnZtYzdqYzdxcSZlcD12MV9naWZzX3NlYXJjaCZjdD1n/7xX61J8Bs4PrSnvcZ0/giphy.gif",
                    description: "A turtle Pok√©mon with powerful water cannons on its shell. The cannons can shoot water with enough force to punch through thick steel."
                },
                {
                    name: "Venusaur",
                    type: "Grass",
                    hp: 100,
                    attacks: [
                        { name: "Solar Beam", damage: 80 },
                        { name: "Vine Whip", damage: 30 }
                    ],
                    weakness: "Fire",
                    resistance: "Water",
                    rarity: "Rare",
                    image: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExaHBkY3R0NGpldDFrY21kbTJzb2d0eXRzc2RoeHA1NHlhb2l1NXowZiZlcD12MV9zdGlja2Vyc19zZWFyY2gmY3Q9cw/EJOdcxm52IWNq/giphy.gif",
                    description: "A seed Pok√©mon that uses the flower on its back for photosynthesis. The flower is said to take on vivid colors if it gets plenty of nutrition and sunlight."
                },
                {
                    name: "Gengar",
                    type: "Ghost",
                    hp: 80,
                    attacks: [
                        { name: "Shadow Ball", damage: 60 },
                        { name: "Night Shade", damage: 20 }
                    ],
                    weakness: "Dark",
                    resistance: "Fighting",
                    rarity: "Uncommon",
                    image: "https://media.giphy.com/media/v1.Y2lkPWVjZjA1ZTQ3OGl5dTdub285YWo5djQ5eXl3dnBkeTFpeTlteXB4cm05aDM4ZWl6aiZlcD12MV9naWZzX3NlYXJjaCZjdD1n/GBSCVDCnSE0e9zofGq/giphy.gif",
                    description: "A shadow Pok√©mon that hides in the dark waiting for its prey. On the night of a full moon, if shadows move on their own and laugh, it must be Gengar's doing."
                },
                {
                    name: "Dragonite",
                    type: "Dragon",
                    hp: 150,
                    attacks: [
                        { name: "Dragon Claw", damage: 70 },
                        { name: "Hyper Beam", damage: 120 }
                    ],
                    weakness: "Fairy",
                    resistance: "None",
                    rarity: "Rare Holo",
                    image: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExd3FqaDRta2w3YXEzeDJzaGl2Mmx2Z3preXB3YmRiZnEzaXoxMnZ1MCZlcD12MV9naWZzX3NlYXJjaCZjdD1n/eTeIyqTPy6SDS9ueB2/giphy.gif",
                    description: "A dragon Pok√©mon that can fly faster than the speed of sound. It is said that this Pok√©mon lives somewhere in the sea and guides lost ships to safety."
                },
                {
                    name: "Eevee",
                    type: "Normal",
                    hp: 50,
                    attacks: [
                        { name: "Tackle", damage: 10 },
                        { name: "Tail Whip", damage: 0 }
                    ],
                    weakness: "Fighting",
                    resistance: "None",
                    rarity: "Common",
                    image: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExMWJjajg5ZWFtZmpzZHFrNGV4azY5aW92bjloaGF5MDJnNTFqYmtvcCZlcD12MV9naWZzX3NlYXJjaCZjdD1n/kCelYpDRCtWNy/giphy.gif",
                    description: "Its genetic code is irregular. It may evolve if exposed to radiation from element stones. Its ability to evolve into many forms allows it to adapt smoothly and perfectly to any environment."
                },
                {
                    name: "Snorlax",
                    type: "Normal",
                    hp: 100,
                    attacks: [
                        { name: "Body Slam", damage: 30 },
                        { name: "Rest", damage: 0 }
                    ],
                    weakness: "Fighting",
                    resistance: "None",
                    rarity: "Uncommon",
                    image: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExaWV4eWowdnhrOTZ5ZG16ZWMyeDhsNTRzM242Ym1jOGRlcnl6dGVqbCZlcD12MV9naWZzX3NlYXJjaCZjdD1n/CXaDzPow0SJqM/giphy.gif",
                    description: "Very lazy. Just eats and sleeps. As its rotund bulk builds, it becomes steadily more slothful. It can devour nearly 900 pounds of food in one sitting."
                },
                {
                    name: "Mewtwo",
                    type: "Psychic",
                    hp: 130,
                    attacks: [
                        { name: "Psychic", damage: 100 },
                        { name: "Barrier", damage: 0 }
                    ],
                    weakness: "Psychic",
                    resistance: "Fighting",
                    rarity: "Rare Holo",
                    image: "https://media.giphy.com/media/v1.Y2lkPWVjZjA1ZTQ3cWZtZHFxcXUxdWxwdTJqeDdzejZzcXF1aGxjeGJhOHcxdTc0emE2bSZlcD12MV9naWZzX3NlYXJjaCZjdD1n/Y151GB9PFnvQa93qSg/giphy.gif",
                    description: "It was created by a scientist after years of horrific gene-splicing and DNA-engineering experiments. Its DNA is almost the same as Mew's. However, its size and disposition are vastly different."
                }
            ],
            
            // No energy cards
            energyCards: [],
            
            // No trainer cards
            trainerCards: [],
            
            giftSuggestions: [
                "Funny Christmas socks with Pok√©mon designs",
                "Mini desk plant in a Pok√©ball pot",
                "Custom Pok√©mon coffee mug",
                "LED Pok√©ball night light",
                "Pok√©mon-themed board game",
                "Set of dice with Pok√©mon symbols",
                "Phone case with Christmas Pok√©mon art",
                "Portable phone charger shaped like a Pok√©ball",
                "Christmas sweater with subtle Pok√©mon patterns",
                "Set of Pok√©mon enamel pins",
                "Hot chocolate kit with Pok√©ball mug",
                "Bluetooth speaker shaped like a Jigglypuff",
                "Desk organizer with Pok√©mon compartments",
                "LED light strip with color-changing Pok√©balls",
                "Pok√©mon card binder for their collection",
                "Set of Pok√©mon-themed kitchen towels",
                "Custom Pok√©mon keychain with their favorite",
                "Pok√©mon plushie wearing a Santa hat",
                "Scented candles with Pok√©mon-inspired scents",
                "Pok√©mon-themed escape room board game"
            ]
        };

        // Carousel State - UPDATED
        const carouselState = {
            currentSlide: 0,
            totalSlides: 9, // 8 Pok√©mon + 1 Secret Santa
            cards: [],
            visitedSlides: new Set([0]),
            playerNumber: null,
            targetPlayerNumber: null,
            giftSuggestion: null
        };

        // Pack Opening State - UPDATED
        const packState = {
            isPackOpened: false,
            cardsRevealed: false
        };

        // Snowman class for aim trainer - UPDATED WITH WHOLE SNOWMAN HIT AREA
        class Snowman {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.width = 120; // Total width of snowman (for hit detection)
                this.height = 180; // Total height of snowman (for hit detection)
                this.speed = Math.random() * 2 + 1; // Random speed
                this.direction = Math.random() > 0.5 ? 1 : -1; // Random direction
            }

            draw() {
                // Draw bottom snowball
                ctx.fillStyle = 'white';
                ctx.beginPath();
                ctx.arc(this.x, this.y, 50, 0, Math.PI * 2);
                ctx.fill();
                ctx.strokeStyle = '#e0e0e0';
                ctx.lineWidth = 2;
                ctx.stroke();

                // Draw middle snowball
                ctx.beginPath();
                ctx.arc(this.x, this.y - 70, 40, 0, Math.PI * 2);
                ctx.fill();
                ctx.stroke();

                // Draw head snowball
                ctx.beginPath();
                ctx.arc(this.x, this.y - 130, 30, 0, Math.PI * 2);
                ctx.fill();
                ctx.stroke();

                // Draw eyes
                ctx.fillStyle = 'black';
                ctx.beginPath();
                ctx.arc(this.x - 10, this.y - 140, 3, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
                ctx.arc(this.x + 10, this.y - 140, 3, 0, Math.PI * 2);
                ctx.fill();

                // Draw carrot nose
                ctx.fillStyle = 'orange';
                ctx.beginPath();
                ctx.moveTo(this.x, this.y - 135);
                ctx.lineTo(this.x + 20, this.y - 130);
                ctx.lineTo(this.x, this.y - 125);
                ctx.fill();

                // Draw smile
                ctx.strokeStyle = 'black';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(this.x, this.y - 125, 10, 0.2, Math.PI - 0.2);
                ctx.stroke();

                // Draw buttons
                ctx.fillStyle = 'black';
                ctx.beginPath();
                ctx.arc(this.x, this.y - 60, 4, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
                ctx.arc(this.x, this.y - 40, 4, 0, Math.PI * 2);
                ctx.fill();

                // Draw hat
                ctx.fillStyle = 'black';
                ctx.fillRect(this.x - 25, this.y - 165, 50, 10);
                ctx.fillRect(this.x - 15, this.y - 190, 30, 25);
            }

            update() {
                // Move snowman
                this.x += this.speed * this.direction;
                
                // Bounce off walls
                if (this.x - 60 < 0 || this.x + 60 > canvas.width) {
                    this.direction *= -1;
                }
            }

            // Check if point is inside the snowman (any part)
            isHit(x, y) {
                // Calculate the bounding box of the entire snowman
                const left = this.x - this.width / 2;
                const right = this.x + this.width / 2;
                const top = this.y - this.height;
                const bottom = this.y;
                
                // Check if the click is within the bounding box
                return x >= left && x <= right && y >= top && y <= bottom;
            }
        }

        // Canvas setup for aim trainer
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // BUDGET ALLOCATION FUNCTIONS - FIXED VERSION WITH REAL-TIME UPDATES
        function initBudgetScreen() {
            console.log("Initializing budget screen with real-time updates");
            
            const budgetDec1 = document.getElementById('budgetDec1');
            const budgetDec2 = document.getElementById('budgetDec2');
            const budgetDec3 = document.getElementById('budgetDec3');
            const budgetDec4 = document.getElementById('budgetDec4');
            
            const budgetDec1Amount = document.getElementById('budgetDec1Amount');
            const budgetDec2Amount = document.getElementById('budgetDec2Amount');
            const budgetDec3Amount = document.getElementById('budgetDec3Amount');
            const budgetDec4Amount = document.getElementById('budgetDec4Amount');
            
            const budgetRemaining = document.getElementById('budgetRemaining');
            const budgetNextBtn = document.getElementById('budgetNextBtn');
            
            // Initialize slider values from gameState
            budgetDec1.value = gameState.budgetAllocation['dec-1'];
            budgetDec2.value = gameState.budgetAllocation['dec-2'];
            budgetDec3.value = gameState.budgetAllocation['dec-3'];
            budgetDec4.value = gameState.budgetAllocation['dec-4'];
            
            // Update display immediately
            updateBudgetDisplay();
            
            function updateBudgetDisplay() {
                // Update individual amounts in REAL-TIME
                budgetDec1Amount.textContent = `$${gameState.budgetAllocation['dec-1']}`;
                budgetDec2Amount.textContent = `$${gameState.budgetAllocation['dec-2']}`;
                budgetDec3Amount.textContent = `$${gameState.budgetAllocation['dec-3']}`;
                budgetDec4Amount.textContent = `$${gameState.budgetAllocation['dec-4']}`;
                
                // Always enable the next button since there's no total cap
                budgetNextBtn.disabled = false;
                
                // Update the message to reflect no budget limit
                budgetRemaining.textContent = "No budget limit - allocate up to $100 for each date";
                budgetRemaining.className = 'budget-remaining';
                
                console.log("Budget updated:", gameState.budgetAllocation);
            }
            
            // Set up event listeners for REAL-TIME updates
            budgetDec1.addEventListener('input', (e) => {
                gameState.budgetAllocation['dec-1'] = parseInt(e.target.value);
                updateBudgetDisplay();
            });
            
            budgetDec2.addEventListener('input', (e) => {
                gameState.budgetAllocation['dec-2'] = parseInt(e.target.value);
                updateBudgetDisplay();
            });
            
            budgetDec3.addEventListener('input', (e) => {
                gameState.budgetAllocation['dec-3'] = parseInt(e.target.value);
                updateBudgetDisplay();
            });
            
            budgetDec4.addEventListener('input', (e) => {
                gameState.budgetAllocation['dec-4'] = parseInt(e.target.value);
                updateBudgetDisplay();
            });
            
            // Also listen for change events for additional reliability
            budgetDec1.addEventListener('change', (e) => {
                gameState.budgetAllocation['dec-1'] = parseInt(e.target.value);
                updateBudgetDisplay();
            });
            
            budgetDec2.addEventListener('change', (e) => {
                gameState.budgetAllocation['dec-2'] = parseInt(e.target.value);
                updateBudgetDisplay();
            });
            
            budgetDec3.addEventListener('change', (e) => {
                gameState.budgetAllocation['dec-3'] = parseInt(e.target.value);
                updateBudgetDisplay();
            });
            
            budgetDec4.addEventListener('change', (e) => {
                gameState.budgetAllocation['dec-4'] = parseInt(e.target.value);
                updateBudgetDisplay();
            });
        }

        // NEW: Public Results Function - ADDED FOR PUBLIC ACCESS
        function updatePublicResults() {
            // Date Results
            const publicDateResults = document.getElementById('publicDateResults');
            publicDateResults.innerHTML = '';
            
            const dateLabels = {
                'dec-1': 'December 7-9',
                'dec-2': 'December 14-16', 
                'dec-3': 'December 21-23',
                'dec-4': 'December 27-28'
            };
            
            let maxDateTotal = 0;
            Object.values(gameState.votingData).forEach(date => {
                const total = date.points + date.budget;
                if (total > maxDateTotal) maxDateTotal = total;
            });
            
            Object.entries(gameState.votingData).forEach(([dateKey, dateData]) => {
                const total = dateData.points + dateData.budget;
                const percentage = maxDateTotal > 0 ? (total / maxDateTotal) * 100 : 0;
                
                const resultItem = document.createElement('div');
                resultItem.className = 'result-item';
                resultItem.innerHTML = `
                    <div class="result-label">${dateLabels[dateKey]}</div>
                    <div class="result-value">${total} pts</div>
                    <div class="result-bar" style="width: ${percentage}%"></div>
                    <div class="result-stats">
                        <span>Game Points: ${dateData.points}</span>
                        <span>Budget: $${dateData.budget}</span>
                        <span>Voters: ${dateData.voters}</span>
                    </div>
                `;
                publicDateResults.appendChild(resultItem);
            });
            
            // Duration Results
            const publicDurationResults = document.getElementById('publicDurationResults');
            publicDurationResults.innerHTML = '';
            
            const durationLabels = {
                'fri-sun': '3 Days (Fri-Sun)',
                'sat-sun': '2 Days (Sat-Sun)',
                'sat-only': 'Saturday Only',
                'sun-only': 'Sunday Only'
            };
            
            let maxDurationVotes = 0;
            Object.values(gameState.durationData).forEach(duration => {
                if (duration.votes > maxDurationVotes) maxDurationVotes = duration.votes;
            });
            
            Object.entries(gameState.durationData).forEach(([durationKey, durationData]) => {
                const percentage = maxDurationVotes > 0 ? (durationData.votes / maxDurationVotes) * 100 : 0;
                
                const resultItem = document.createElement('div');
                resultItem.className = 'result-item';
                resultItem.innerHTML = `
                    <div class="result-label">${durationLabels[durationKey]}</div>
                    <div class="result-value">${durationData.votes} votes</div>
                    <div class="result-bar" style="width: ${percentage}%"></div>
                    <div class="result-stats">
                        <span>Points: ${durationData.points}</span>
                    </div>
                `;
                publicDurationResults.appendChild(resultItem);
            });
            
            // Activity Results
            const publicActivityResults = document.getElementById('publicActivityResults');
            publicActivityResults.innerHTML = '';
            
            const activityLabels = {
                'skating': 'Ice Skating',
                'k1-speed': 'K1 Speed Go Kart',
                'kickball-soccer': 'Kickball & Soccer',
                'hiking': 'Winter Hiking'
            };
            
            let maxActivityVotes = 0;
            Object.values(gameState.activityData).forEach(activity => {
                if (activity.votes > maxActivityVotes) maxActivityVotes = activity.votes;
            });
            
            Object.entries(gameState.activityData).forEach(([activityKey, activityData]) => {
                const percentage = maxActivityVotes > 0 ? (activityData.votes / maxActivityVotes) * 100 : 0;
                
                const resultItem = document.createElement('div');
                resultItem.className = 'result-item';
                resultItem.innerHTML = `
                    <div class="result-label">${activityLabels[activityKey]}</div>
                    <div class="result-value">${activityData.votes} votes</div>
                    <div class="result-bar" style="width: ${percentage}%"></div>
                `;
                publicActivityResults.appendChild(resultItem);
            });
            
            // Location Results
            const publicLocationResults = document.getElementById('publicLocationResults');
            publicLocationResults.innerHTML = '';
            
            const locationLabels = {
                'seattle': 'Seattle',
                'taiwan': 'Taiwan',
                'hamilton': 'Hamilton',
                'north-york': 'North York',
                'mississauga': 'Mississauga'
            };
            
            let maxLocationVotes = 0;
            Object.values(gameState.locationData).forEach(location => {
                if (location.votes > maxLocationVotes) maxLocationVotes = location.votes;
            });
            
            Object.entries(gameState.locationData).forEach(([locationKey, locationData]) => {
                const percentage = maxLocationVotes > 0 ? (locationData.votes / maxLocationVotes) * 100 : 0;
                
                const resultItem = document.createElement('div');
                resultItem.className = 'result-item';
                resultItem.innerHTML = `
                    <div class="result-label">${locationLabels[locationKey]}</div>
                    <div class="result-value">${locationData.votes} votes</div>
                    <div class="result-bar" style="width: ${percentage}%"></div>
                `;
                publicLocationResults.appendChild(resultItem);
            });
            
            // Attire Results
            const publicAttireResults = document.getElementById('publicAttireResults');
            publicAttireResults.innerHTML = '';
            
            const attireLabels = {
                'pajamas': 'Christmas Pajamas',
                'ugly-sweater': 'Ugly Christmas Sweater',
                'formal': 'Festive Formal',
                'casual': 'Casual Christmas'
            };
            
            let maxAttireVotes = 0;
            Object.values(gameState.attireData).forEach(attire => {
                if (attire.votes > maxAttireVotes) maxAttireVotes = attire.votes;
            });
            
            Object.entries(gameState.attireData).forEach(([attireKey, attireData]) => {
                const percentage = maxAttireVotes > 0 ? (attireData.votes / maxAttireVotes) * 100 : 0;
                
                const resultItem = document.createElement('div');
                resultItem.className = 'result-item';
                resultItem.innerHTML = `
                    <div class="result-label">${attireLabels[attireKey]}</div>
                    <div class="result-value">${attireData.votes} votes</div>
                    <div class="result-bar" style="width: ${percentage}%"></div>
                `;
                publicAttireResults.appendChild(resultItem);
            });
            
            // Moonshine Results
            const publicMoonshineResults = document.getElementById('publicMoonshineResults');
            publicMoonshineResults.innerHTML = '';
            
            const moonshineLabels = {
                'yes': 'Yes',
                'no': 'No',
                'maybe': 'Maybe'
            };
            
            let maxMoonshineVotes = 0;
            Object.values(gameState.moonshineData).forEach(moonshine => {
                if (moonshine.votes > maxMoonshineVotes) maxMoonshineVotes = moonshine.votes;
            });
            
            Object.entries(gameState.moonshineData).forEach(([moonshineKey, moonshineData]) => {
                const percentage = maxMoonshineVotes > 0 ? (moonshineData.votes / maxMoonshineVotes) * 100 : 0;
                
                const resultItem = document.createElement('div');
                resultItem.className = 'result-item';
                resultItem.innerHTML = `
                    <div class="result-label">${moonshineLabels[moonshineKey]}</div>
                    <div class="result-value">${moonshineData.votes} votes</div>
                    <div class="result-bar" style="width: ${percentage}%"></div>
                `;
                publicMoonshineResults.appendChild(resultItem);
            });
            
            // Update total voters
            document.getElementById('publicTotalVoters').textContent = gameState.submissions.length;
        }

        // Screen navigation function
        function showScreen(screenId) {
            // Hide all screens
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            
            // Show the requested screen
            document.getElementById(screenId).classList.add('active');
            gameState.currentScreen = screenId;
            
            // Special handling for game screen
            if (screenId === 'gameScreen') {
                // Reset game state
                gameState.gameScore = 0;
                gameState.targetsHit = 0;
                gameState.gameTime = 60;
                gameState.isGameRunning = false;
                gameState.targets = [];
                
                // Clear any existing game timer
                if (gameState.gameTimer) {
                    clearInterval(gameState.gameTimer);
                }
                
                // Reset UI elements
                document.getElementById('startGameBtn').classList.remove('hidden');
                document.getElementById('gameNextBtn').classList.add('hidden');
                
                // Draw initial screen
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
                ctx.font = 'bold 36px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Click "Start Game" to begin!', canvas.width / 2, canvas.height / 2);
                
                updateGameDisplay();
            }
            
            // Special handling for secret santa screen - UPDATED
            if (screenId === 'secretSantaScreen') {
                initTCGPackOpening(); // Now initializes pack opening
            }
            
            // Special handling for budget screen - INITIALIZE BUDGET SLIDERS
            if (screenId === 'budgetScreen') {
                initBudgetScreen(); // Initialize budget sliders with real-time updates
            }
            
            // Update results when showing results screen
            if (screenId === 'resultsScreen') {
                updateResults();
                updateAnonymousResults();
            }
            
            // Update public results when showing public results screen
            if (screenId === 'publicResultsScreen') {
                updatePublicResults();
            }
        }

        // NEW: Function to update anonymous results display
        function updateAnonymousResults() {
            // Date Results
            const dateResults = document.getElementById('dateResults');
            dateResults.innerHTML = '';
            
            const dateLabels = {
                'dec-1': 'December 7-9',
                'dec-2': 'December 14-16', 
                'dec-3': 'December 21-23',
                'dec-4': 'December 27-28'
            };
            
            let maxDateTotal = 0;
            Object.values(gameState.votingData).forEach(date => {
                const total = date.points + date.budget;
                if (total > maxDateTotal) maxDateTotal = total;
            });
            
            Object.entries(gameState.votingData).forEach(([dateKey, dateData]) => {
                const total = dateData.points + dateData.budget;
                const percentage = maxDateTotal > 0 ? (total / maxDateTotal) * 100 : 0;
                
                const resultItem = document.createElement('div');
                resultItem.className = 'result-item';
                resultItem.innerHTML = `
                    <div class="result-label">${dateLabels[dateKey]}</div>
                    <div class="result-value">${total} pts</div>
                    <div class="result-bar" style="width: ${percentage}%"></div>
                    <div class="result-stats">
                        <span>Game Points: ${dateData.points}</span>
                        <span>Budget: $${dateData.budget}</span>
                        <span>Voters: ${dateData.voters}</span>
                    </div>
                `;
                dateResults.appendChild(resultItem);
            });
            
            // Duration Results
            const durationResults = document.getElementById('durationResults');
            durationResults.innerHTML = '';
            
            const durationLabels = {
                'fri-sun': '3 Days (Fri-Sun)',
                'sat-sun': '2 Days (Sat-Sun)',
                'sat-only': 'Saturday Only',
                'sun-only': 'Sunday Only'
            };
            
            let maxDurationVotes = 0;
            Object.values(gameState.durationData).forEach(duration => {
                if (duration.votes > maxDurationVotes) maxDurationVotes = duration.votes;
            });
            
            Object.entries(gameState.durationData).forEach(([durationKey, durationData]) => {
                const percentage = maxDurationVotes > 0 ? (durationData.votes / maxDurationVotes) * 100 : 0;
                
                const resultItem = document.createElement('div');
                resultItem.className = 'result-item';
                resultItem.innerHTML = `
                    <div class="result-label">${durationLabels[durationKey]}</div>
                    <div class="result-value">${durationData.votes} votes</div>
                    <div class="result-bar" style="width: ${percentage}%"></div>
                    <div class="result-stats">
                        <span>Points: ${durationData.points}</span>
                    </div>
                `;
                durationResults.appendChild(resultItem);
            });
            
            // Activity Results
            const activityResults = document.getElementById('activityResults');
            activityResults.innerHTML = '';
            
            const activityLabels = {
                'skating': 'Ice Skating',
                'k1-speed': 'K1 Speed Go Kart',
                'kickball-soccer': 'Kickball & Soccer',
                'hiking': 'Winter Hiking'
            };
            
            let maxActivityVotes = 0;
            Object.values(gameState.activityData).forEach(activity => {
                if (activity.votes > maxActivityVotes) maxActivityVotes = activity.votes;
            });
            
            Object.entries(gameState.activityData).forEach(([activityKey, activityData]) => {
                const percentage = maxActivityVotes > 0 ? (activityData.votes / maxActivityVotes) * 100 : 0;
                
                const resultItem = document.createElement('div');
                resultItem.className = 'result-item';
                resultItem.innerHTML = `
                    <div class="result-label">${activityLabels[activityKey]}</div>
                    <div class="result-value">${activityData.votes} votes</div>
                    <div class="result-bar" style="width: ${percentage}%"></div>
                `;
                activityResults.appendChild(resultItem);
            });
            
            // Location Results
            const locationResults = document.getElementById('locationResults');
            locationResults.innerHTML = '';
            
            const locationLabels = {
                'seattle': 'Seattle',
                'taiwan': 'Taiwan',
                'hamilton': 'Hamilton',
                'north-york': 'North York',
                'mississauga': 'Mississauga'
            };
            
            let maxLocationVotes = 0;
            Object.values(gameState.locationData).forEach(location => {
                if (location.votes > maxLocationVotes) maxLocationVotes = location.votes;
            });
            
            Object.entries(gameState.locationData).forEach(([locationKey, locationData]) => {
                const percentage = maxLocationVotes > 0 ? (locationData.votes / maxLocationVotes) * 100 : 0;
                
                const resultItem = document.createElement('div');
                resultItem.className = 'result-item';
                resultItem.innerHTML = `
                    <div class="result-label">${locationLabels[locationKey]}</div>
                    <div class="result-value">${locationData.votes} votes</div>
                    <div class="result-bar" style="width: ${percentage}%"></div>
                `;
                locationResults.appendChild(resultItem);
            });
            
            // Attire Results
            const attireResults = document.getElementById('attireResults');
            attireResults.innerHTML = '';
            
            const attireLabels = {
                'pajamas': 'Christmas Pajamas',
                'ugly-sweater': 'Ugly Christmas Sweater',
                'formal': 'Festive Formal',
                'casual': 'Casual Christmas'
            };
            
            let maxAttireVotes = 0;
            Object.values(gameState.attireData).forEach(attire => {
                if (attire.votes > maxAttireVotes) maxAttireVotes = attire.votes;
            });
            
            Object.entries(gameState.attireData).forEach(([attireKey, attireData]) => {
                const percentage = maxAttireVotes > 0 ? (attireData.votes / maxAttireVotes) * 100 : 0;
                
                const resultItem = document.createElement('div');
                resultItem.className = 'result-item';
                resultItem.innerHTML = `
                    <div class="result-label">${attireLabels[attireKey]}</div>
                    <div class="result-value">${attireData.votes} votes</div>
                    <div class="result-bar" style="width: ${percentage}%"></div>
                `;
                attireResults.appendChild(resultItem);
            });
            
            // Moonshine Results
            const moonshineResults = document.getElementById('moonshineResults');
            moonshineResults.innerHTML = '';
            
            const moonshineLabels = {
                'yes': 'Yes',
                'no': 'No',
                'maybe': 'Maybe'
            };
            
            let maxMoonshineVotes = 0;
            Object.values(gameState.moonshineData).forEach(moonshine => {
                if (moonshine.votes > maxMoonshineVotes) maxMoonshineVotes = moonshine.votes;
            });
            
            Object.entries(gameState.moonshineData).forEach(([moonshineKey, moonshineData]) => {
                const percentage = maxMoonshineVotes > 0 ? (moonshineData.votes / maxMoonshineVotes) * 100 : 0;
                
                const resultItem = document.createElement('div');
                resultItem.className = 'result-item';
                resultItem.innerHTML = `
                    <div class="result-label">${moonshineLabels[moonshineKey]}</div>
                    <div class="result-value">${moonshineData.votes} votes</div>
                    <div class="result-bar" style="width: ${percentage}%"></div>
                `;
                moonshineResults.appendChild(resultItem);
            });
        }

async function submitForm() {
    const nameInput = document.getElementById('nameInput');
    const emailInput = document.getElementById('emailInput');
    
    gameState.playerName = nameInput.value.trim();
    gameState.playerEmail = emailInput.value.trim();
    
    console.log('üìù FORM SUBMISSION:', {
        name: gameState.playerName,
        email: gameState.playerEmail,
        playerNumber: carouselState.playerNumber,
        targetNumber: carouselState.targetPlayerNumber
    });

    // Validation
    if (!gameState.playerName || !gameState.playerEmail) {
        alert('Please fill in both name and email');
        return;
    }
    
    // Generate player ID if needed
    if (!gameState.playerId) {
        gameState.playerId = 'player_' + Date.now();
    }

    // Show loading message
    document.getElementById('emailNotification').textContent = 'Saving your information and sending emails...';

    // Save submission
    await saveSubmission();
    
    // Send Secret Santa assignment email
    const secretSantaSuccess = await sendSecretSantaEmail(
        gameState.playerEmail,
        gameState.playerName,
        carouselState.playerNumber,
        carouselState.targetPlayerNumber,
        carouselState.giftSuggestion
    );

    // Send new voter notification to admin
    const lastSubmission = gameState.submissions[gameState.submissions.length - 1];
    await sendNewVoterNotification(lastSubmission);
    
    // Show results
    showScreen('resultsScreen');
    updateResults();
    
    // Show confirmation message
    if (secretSantaSuccess) {
        document.getElementById('emailNotification').textContent = 
            '‚úÖ Your information has been saved and your Secret Santa assignment has been emailed to you!';
    } else {
        document.getElementById('emailNotification').textContent = 
            '‚ö†Ô∏è Your information has been saved, but there was an issue sending the email. Please check the results below for your Secret Santa assignment.';
    }
}
        // Quote Game Functions
        function initQuoteGame() {
            gameState.currentQuoteIndex = 0;
            gameState.quoteScore = 0;
            showCurrentQuote();
        }

        function showCurrentQuote() {
            const quote = christmasQuotes[gameState.currentQuoteIndex];
            const quoteText = document.getElementById('quoteText');
            const quoteOptions = document.getElementById('quoteOptions');
            const quoteScore = document.getElementById('quoteScore');
            const quoteProgress = document.getElementById('quoteProgress');
            const quoteNextBtn = document.getElementById('quoteNextBtn');
            const quoteGameNextBtn = document.getElementById('quoteGameNextBtn');

            quoteText.textContent = `"${quote.quote}"`;
            quoteOptions.innerHTML = '';
            quoteScore.textContent = gameState.quoteScore;
            quoteProgress.textContent = `${gameState.currentQuoteIndex + 1}/${christmasQuotes.length}`;

            quote.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'quote-option';
                optionElement.textContent = option;
                optionElement.addEventListener('click', () => {
                    checkQuoteAnswer(index);
                });
                quoteOptions.appendChild(optionElement);
            });

            quoteNextBtn.classList.add('hidden');
            quoteGameNextBtn.classList.add('hidden');
        }

        function checkQuoteAnswer(selectedIndex) {
            const quote = christmasQuotes[gameState.currentQuoteIndex];
            const options = document.querySelectorAll('#quoteOptions .quote-option');
            const quoteNextBtn = document.getElementById('quoteNextBtn');
            const quoteGameNextBtn = document.getElementById('quoteGameNextBtn');

            options.forEach((option, index) => {
                if (index === quote.correct) {
                    option.classList.add('correct');
                } else if (index === selectedIndex) {
                    option.classList.add('incorrect');
                }
                option.style.pointerEvents = 'none';
            });

            if (selectedIndex === quote.correct) {
                gameState.quoteScore += 10;
                document.getElementById('quoteScore').textContent = gameState.quoteScore;
            }

            gameState.currentQuoteIndex++;

            if (gameState.currentQuoteIndex < christmasQuotes.length) {
                quoteNextBtn.classList.remove('hidden');
            } else {
                quoteGameNextBtn.classList.remove('hidden');
            }
        }

        function nextQuote() {
            showCurrentQuote();
        }

        // LoL Quote Game Functions
        function initLolGame() {
            gameState.currentLolQuoteIndex = 0;
            gameState.lolQuoteScore = 0;
            showCurrentLolQuote();
        }

        function showCurrentLolQuote() {
            const quote = lolQuotes[gameState.currentLolQuoteIndex];
            const quoteText = document.getElementById('lolQuoteText');
            const quoteOptions = document.getElementById('lolQuoteOptions');
            const quoteScore = document.getElementById('lolQuoteScore');
            const quoteProgress = document.getElementById('lolQuoteProgress');
            const quoteNextBtn = document.getElementById('lolQuoteNextBtn');
            const quoteGameNextBtn = document.getElementById('lolGameNextBtn');

            quoteText.textContent = `"${quote.quote}"`;
            quoteOptions.innerHTML = '';
            quoteScore.textContent = gameState.lolQuoteScore;
            quoteProgress.textContent = `${gameState.currentLolQuoteIndex + 1}/${lolQuotes.length}`;

            quote.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'quote-option';
                optionElement.textContent = option;
                optionElement.addEventListener('click', () => {
                    checkLolQuoteAnswer(index);
                });
                quoteOptions.appendChild(optionElement);
            });

            quoteNextBtn.classList.add('hidden');
            quoteGameNextBtn.classList.add('hidden');
        }

        function checkLolQuoteAnswer(selectedIndex) {
            const quote = lolQuotes[gameState.currentLolQuoteIndex];
            const options = document.querySelectorAll('#lolQuoteOptions .quote-option');
            const quoteNextBtn = document.getElementById('lolQuoteNextBtn');
            const quoteGameNextBtn = document.getElementById('lolGameNextBtn');

            options.forEach((option, index) => {
                if (index === quote.correct) {
                    option.classList.add('correct');
                } else if (index === selectedIndex) {
                    option.classList.add('incorrect');
                }
                option.style.pointerEvents = 'none';
            });

            if (selectedIndex === quote.correct) {
                gameState.lolQuoteScore += 10;
                document.getElementById('lolQuoteScore').textContent = gameState.lolQuoteScore;
            }

            gameState.currentLolQuoteIndex++;

            if (gameState.currentLolQuoteIndex < lolQuotes.length) {
                quoteNextBtn.classList.remove('hidden');
            } else {
                quoteGameNextBtn.classList.remove('hidden');
            }
        }

        function nextLolQuote() {
            showCurrentLolQuote();
        }

        // Song Game Functions
        function initSongGame() {
            gameState.currentSongIndex = 0;
            gameState.songScore = 0;
            showCurrentSong();
        }

        function showCurrentSong() {
            const song = christmasSongs[gameState.currentSongIndex];
            const songLyrics = document.getElementById('songLyricsText');
            const songInput = document.getElementById('songInput');
            const songScore = document.getElementById('songScore');
            const songProgress = document.getElementById('songProgress');
            const songSubmitBtn = document.getElementById('songSubmitBtn');
            const songNextBtn = document.getElementById('songNextBtn');
            const songGameNextBtn = document.getElementById('songGameNextBtn');
            const songFeedback = document.getElementById('songFeedback');

            songLyrics.textContent = song.lyrics;
            songInput.value = '';
            songFeedback.textContent = '';
            songScore.textContent = gameState.songScore;
            songProgress.textContent = `${gameState.currentSongIndex + 1}/${christmasSongs.length}`;

            songSubmitBtn.classList.remove('hidden');
            songNextBtn.classList.add('hidden');
            songGameNextBtn.classList.add('hidden');
        }

        function checkSongAnswer() {
            const song = christmasSongs[gameState.currentSongIndex];
            const songInput = document.getElementById('songInput');
            const songFeedback = document.getElementById('songFeedback');
            const songSubmitBtn = document.getElementById('songSubmitBtn');
            const songNextBtn = document.getElementById('songNextBtn');
            const songGameNextBtn = document.getElementById('songGameNextBtn');

            const userGuess = songInput.value.trim().toLowerCase();
            const correctAnswer = song.title.toLowerCase();

            if (userGuess === correctAnswer) {
                songFeedback.textContent = 'Correct! +10 points';
                songFeedback.style.color = '#4ecdc4';
                gameState.songScore += 10;
                document.getElementById('songScore').textContent = gameState.songScore;
            } else {
                songFeedback.textContent = `Incorrect! The answer was: ${song.title}`;
                songFeedback.style.color = '#ff6b6b';
            }

            songSubmitBtn.classList.add('hidden');
            gameState.currentSongIndex++;

            if (gameState.currentSongIndex < christmasSongs.length) {
                songNextBtn.classList.remove('hidden');
            } else {
                songGameNextBtn.classList.remove('hidden');
            }
        }

        function nextSong() {
            showCurrentSong();
        }

        // Wordle Game Functions - FIXED VERSION
        function initWordleGame() {
            // Reset Wordle game state
            gameState.wordleAttempts = 5;
            gameState.wordleGuesses = [];
            gameState.wordleComplete = false;
            gameState.wordleScore = 0;
            
            // Select a random word from the word list
            const randomIndex = Math.floor(Math.random() * wordleWords.length);
            gameState.wordleWord = wordleWords[randomIndex];
            
            // Update the display
            updateWordleGame();
            
            // Reset UI elements
            document.getElementById('wordleInput').disabled = false;
            document.getElementById('wordleGuessBtn').disabled = false;
            document.getElementById('wordleCompleteMessage').classList.add('hidden');
            document.getElementById('wordleNextBtn').classList.add('hidden');
        }

        function checkWordleGuess() {
            if (gameState.wordleComplete) return;
            
            const guess = document.getElementById('wordleInput').value.toUpperCase().trim();
            
            if (guess.length !== 5) {
                alert('Please enter a 5-letter word');
                return;
            }
            
            // Process the guess
            const guessResult = [];
            const targetWord = gameState.wordleWord;
            
            // First pass: mark correct letters
            for (let i = 0; i < 5; i++) {
                if (guess[i] === targetWord[i]) {
                    guessResult.push({ letter: guess[i], status: 'correct' });
                } else {
                    guessResult.push({ letter: guess[i], status: '' });
                }
            }
            
            // Second pass: mark present and absent letters
            for (let i = 0; i < 5; i++) {
                if (guessResult[i].status !== 'correct') {
                    if (targetWord.includes(guess[i])) {
                        guessResult[i].status = 'present';
                    } else {
                        guessResult[i].status = 'absent';
                    }
                }
            }
            
            gameState.wordleGuesses.push(guessResult);
            gameState.wordleAttempts--;
            
            // Check if the word is correct or out of attempts
            if (guess === targetWord) {
                gameState.wordleComplete = true;
                gameState.wordleScore += 30 - (5 - gameState.wordleAttempts) * 5;
                document.getElementById('wordleResultMessage').textContent = `Congratulations! You guessed the word "${targetWord}"! You earned ${gameState.wordleScore} points.`;
            } else if (gameState.wordleAttempts === 0) {
                gameState.wordleComplete = true;
                document.getElementById('wordleResultMessage').textContent = `Game over! The word was: "${targetWord}". You earned ${gameState.wordleScore} points.`;
            }
            
            // Update the display
            updateWordleGame();
            
            // Show the continue button if game is complete
            if (gameState.wordleComplete) {
                document.getElementById('wordleNextBtn').classList.remove('hidden');
            }
        }

        function updateWordleGame() {
            const grid = document.getElementById('wordleGrid');
            grid.innerHTML = '';
            
            // Create 5 rows for guesses
            for (let i = 0; i < 5; i++) {
                const row = document.createElement('div');
                row.className = 'wordle-row';
                
                for (let j = 0; j < 5; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'wordle-cell';
                    
                    // If we have a guess for this row, fill it in
                    if (gameState.wordleGuesses[i] && gameState.wordleGuesses[i][j]) {
                        cell.textContent = gameState.wordleGuesses[i][j].letter;
                        
                        if (gameState.wordleGuesses[i][j].status === 'correct') {
                            cell.classList.add('correct');
                        } else if (gameState.wordleGuesses[i][j].status === 'present') {
                            cell.classList.add('present');
                        } else {
                            cell.classList.add('absent');
                        }
                    }
                    
                    row.appendChild(cell);
                }
                
                grid.appendChild(row);
            }
            
            document.getElementById('wordleScore').textContent = gameState.wordleScore;
            document.getElementById('wordleAttempts').textContent = gameState.wordleAttempts;
            document.getElementById('wordleInput').value = '';
            
            // Hide/show elements based on game state
            if (gameState.wordleComplete) {
                document.getElementById('wordleInput').disabled = true;
                document.getElementById('wordleGuessBtn').disabled = true;
                document.getElementById('wordleCompleteMessage').classList.remove('hidden');
                document.getElementById('wordleNextBtn').classList.remove('hidden');
            } else {
                document.getElementById('wordleInput').disabled = false;
                document.getElementById('wordleGuessBtn').disabled = false;
                document.getElementById('wordleCompleteMessage').classList.add('hidden');
                document.getElementById('wordleNextBtn').classList.add('hidden');
            }
        }

        // Pok√©mon Game Functions - FIXED VERSION (Randomized correct answers)
        function initPokemonGame() {
            gameState.currentPokemonIndex = 0;
            gameState.pokemonScore = 0;
            showCurrentPokemon();
        }

        function showCurrentPokemon() {
            const pokemon = pokemonData[gameState.currentPokemonIndex];
            const pokemonImage = document.getElementById('pokemonImage');
            const pokemonOptions = document.getElementById('pokemonOptions');
            const pokemonScore = document.getElementById('pokemonScore');
            const pokemonProgress = document.getElementById('pokemonProgress');
            const pokemonNextBtn = document.getElementById('pokemonNextBtn');
            const pokemonGameNextBtn = document.getElementById('pokemonGameNextBtn');

            // Set the image and ensure it's a silhouette from the start
            pokemonImage.src = pokemon.image;
            pokemonImage.classList.add('pokemon-silhouette');
            pokemonImage.classList.remove('pokemon-revealed');
            
            pokemonOptions.innerHTML = '';
            pokemonScore.textContent = gameState.pokemonScore;
            pokemonProgress.textContent = `${gameState.currentPokemonIndex + 1}/${pokemonData.length}`;

            // Randomize the options and track the correct answer position
            const shuffledOptions = [...pokemon.options];
            let correctIndex = pokemon.correct;
            
            // Fisher-Yates shuffle algorithm
            for (let i = shuffledOptions.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffledOptions[i], shuffledOptions[j]] = [shuffledOptions[j], shuffledOptions[i]];
                
                // Update correct index if it was swapped
                if (i === correctIndex) {
                    correctIndex = j;
                } else if (j === correctIndex) {
                    correctIndex = i;
                }
            }

            // Store the correct index for this question
            pokemon.currentCorrectIndex = correctIndex;

            shuffledOptions.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'pokemon-option';
                optionElement.textContent = option;
                optionElement.addEventListener('click', () => {
                    checkPokemonAnswer(index);
                });
                pokemonOptions.appendChild(optionElement);
            });

            pokemonNextBtn.classList.add('hidden');
            pokemonGameNextBtn.classList.add('hidden');
        }

        function checkPokemonAnswer(selectedIndex) {
            const pokemon = pokemonData[gameState.currentPokemonIndex];
            const pokemonImage = document.getElementById('pokemonImage');
            const options = document.querySelectorAll('#pokemonOptions .pokemon-option');
            const pokemonNextBtn = document.getElementById('pokemonNextBtn');
            const pokemonGameNextBtn = document.getElementById('pokemonGameNextBtn');

            // Reveal the Pok√©mon image
            pokemonImage.classList.remove('pokemon-silhouette');
            pokemonImage.classList.add('pokemon-revealed');

            options.forEach((option, index) => {
                if (index === pokemon.currentCorrectIndex) {
                    option.classList.add('correct');
                } else if (index === selectedIndex) {
                    option.classList.add('incorrect');
                }
                option.style.pointerEvents = 'none';
            });

            if (selectedIndex === pokemon.currentCorrectIndex) {
                gameState.pokemonScore += 10;
                document.getElementById('pokemonScore').textContent = gameState.pokemonScore;
            }

            gameState.currentPokemonIndex++;

            if (gameState.currentPokemonIndex < pokemonData.length) {
                pokemonNextBtn.classList.remove('hidden');
            } else {
                pokemonGameNextBtn.classList.remove('hidden');
            }
        }

        function nextPokemon() {
            showCurrentPokemon();
        }

        // REDESIGNED: Pok√©mon TCG Pack Opening Functions - NEW CARD LAYOUT
        function initTCGPackOpening() {
            console.log('Initializing TCG Pack Opening');
            
            const tcgPack = document.getElementById('tcgPack');
            const packInstructions = document.getElementById('packInstructions');
            const cardsContainer = document.getElementById('cardsContainer');
            const tcgCarousel = document.getElementById('tcgCarousel');
            const secretSantaNextBtn = document.getElementById('secretSantaNextBtn');
            
            // Reset state
            packState.isPackOpened = false;
            packState.cardsRevealed = false;
            
            // Clear previous content
            cardsContainer.innerHTML = '';
            cardsContainer.classList.add('hidden');
            tcgCarousel.classList.add('hidden');
            secretSantaNextBtn.classList.add('hidden');
            
            // Generate player number and assignment
            generateSecretSantaAssignment();
            
            // Generate random card pack
            generateCardPack();
            
            // Set up pack click event
            tcgPack.addEventListener('click', openTCGPack);
            tcgPack.classList.remove('opening');
            
            // Update instructions
            packInstructions.textContent = "Click the pack to open it!";
            
            console.log('TCG Pack Opening initialized successfully');
        }

        function openTCGPack() {
            if (packState.isPackOpened) return;
            
            const tcgPack = document.getElementById('tcgPack');
            const packInstructions = document.getElementById('packInstructions');
            const cardsContainer = document.getElementById('cardsContainer');
            const secretSantaNextBtn = document.getElementById('secretSantaNextBtn');
            
            // Mark pack as opened
            packState.isPackOpened = true;
            tcgPack.classList.add('opening');
            
            // Remove click event to prevent multiple openings
            tcgPack.removeEventListener('click', openTCGPack);
            
            // Update instructions
            packInstructions.textContent = "Opening your pack...";
            
            // Create flying cards animation
            createFlyingCards();
            
            // Add sparkle effects
            createSparkleEffects();
            
            // Show carousel after animation
            setTimeout(() => {
                revealCarousel();
                packInstructions.textContent = "Browse through your cards using the navigation buttons!";
                secretSantaNextBtn.classList.remove('hidden');
            }, 3000);
        }

        // UPDATED: Enhanced flying cards animation that rotates around the whole screen
        function createFlyingCards() {
            const cardsContainer = document.getElementById('cardsContainer');
            cardsContainer.classList.remove('hidden');
            
            // Create 9 flying cards with different positions and rotations
            for (let i = 0; i < 9; i++) {
                const card = document.createElement('div');
                card.className = 'flying-card';
                
                // Calculate positions to cover the entire screen
                const screenWidth = window.innerWidth;
                const screenHeight = window.innerHeight;
                
                // Random positions across the entire screen
                const tx = (Math.random() - 0.5) * (screenWidth - 200);
                const ty = (Math.random() - 0.5) * (screenHeight - 280);
                
                // Full rotation (360 degrees or more)
                const rot = (Math.random() * 720) - 360; // -360 to +360 degrees
                
                card.style.setProperty('--tx', `${tx}px`);
                card.style.setProperty('--ty', `${ty}px`);
                card.style.setProperty('--rot', `${rot}deg`);
                
                // Different emojis for each card
                const emojis = ['üéÅ', 'üéÑ', 'üåü', '‚ùÑÔ∏è', 'ü¶å', 'üéÖ', 'ü§∂', 'ü¶å', '‚ú®'];
                card.textContent = emojis[i];
                
                cardsContainer.appendChild(card);
            }
        }

        function createSparkleEffects() {
            const container = document.querySelector('.pack-opening-container');
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const sparkle = document.createElement('div');
                    sparkle.className = 'sparkle';
                    
                    // Random position around the pack
                    const x = Math.random() * 300 - 150;
                    const y = Math.random() * 300 - 150;
                    
                    sparkle.style.left = `calc(50% + ${x}px)`;
                    sparkle.style.top = `calc(50% + ${y}px)`;
                    
                    container.appendChild(sparkle);
                    
                    // Remove sparkle after animation
                    setTimeout(() => {
                        sparkle.remove();
                    }, 1000);
                }, i * 100);
            }
        }

        function revealCarousel() {
            const cardsContainer = document.getElementById('cardsContainer');
            const tcgCarousel = document.getElementById('tcgCarousel');
            
            // Hide flying cards
            cardsContainer.classList.add('hidden');
            
            // Show carousel
            tcgCarousel.classList.remove('hidden');
            
            // Initialize the carousel
            initCarousel();
        }

        function initCarousel() {
            const carouselTrack = document.getElementById('carouselTrack');
            const carouselProgress = document.getElementById('carouselProgress');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const instructions = document.getElementById('carouselInstructions');
            
            // Clear previous content
            carouselTrack.innerHTML = '';
            carouselProgress.innerHTML = '';
            
            // Update total slides based on actual cards
            carouselState.totalSlides = carouselState.cards.length;
            console.log('Creating carousel slides for cards:', carouselState.cards.length);
            
            // Create slides
            carouselState.cards.forEach((card, index) => {
                const slide = document.createElement('div');
                slide.className = 'carousel-slide';
                const cardHTML = createCardHTML(card, index);
                slide.innerHTML = cardHTML;
                carouselTrack.appendChild(slide);
                
                // Create progress dot
                const dot = document.createElement('div');
                dot.className = `progress-dot ${index === 0 ? 'active' : ''}`;
                dot.addEventListener('click', () => goToSlide(index));
                carouselProgress.appendChild(dot);
            });
            
            // Set up event listeners
            prevBtn.addEventListener('click', () => navigateCarousel(-1));
            nextBtn.addEventListener('click', () => navigateCarousel(1));
            
            // Keyboard navigation
            document.addEventListener('keydown', handleKeyboardNavigation);
            
            // Mobile swipe support
            initSwipeSupport();
            
            // Reset current slide to 0
            carouselState.currentSlide = 0;
            carouselState.visitedSlides = new Set([0]);
            
            // Update UI
            updateCarouselUI();
            
            // Update instructions
            instructions.textContent = "Browse through your cards using the navigation buttons!";
            
            console.log('Carousel initialized successfully with', carouselState.totalSlides, 'slides');
        }

        // REDESIGNED: Create Pok√©mon Card HTML with new layout
        function createPokemonCardHTML(pokemon) {
            // Different Christmas-themed backgrounds based on Pok√©mon type
            let backgroundGradient = '';
            switch(pokemon.type) {
                case 'Fire':
                    backgroundGradient = 'linear-gradient(135deg, #ff6b6b, #ff8e8e, #ffd166)';
                    break;
                case 'Water':
                    backgroundGradient = 'linear-gradient(135deg, #4ecdc4, #2a9d8f, #1a759f)';
                    break;
                case 'Grass':
                    backgroundGradient = 'linear-gradient(135deg, #2ecc71, #27ae60, #16a085)';
                    break;
                case 'Electric':
                    backgroundGradient = 'linear-gradient(135deg, #ffd166, #ff9e66, #ff6b6b)';
                    break;
                case 'Psychic':
                    backgroundGradient = 'linear-gradient(135deg, #9b59b6, #8e44ad, #6c5ce7)';
                    break;
                case 'Ghost':
                    backgroundGradient = 'linear-gradient(135deg, #6c5ce7, #a29bfe, #fd79a8)';
                    break;
                case 'Dragon':
                    backgroundGradient = 'linear-gradient(135deg, #e17055, #d63031, #e84393)';
                    break;
                case 'Normal':
                default:
                    backgroundGradient = 'linear-gradient(135deg, #74b9ff, #0984e3, #6c5ce7)';
                    break;
            }

            // Add Christmas pattern overlay
            const christmasPattern = `
                radial-gradient(circle at 20% 80%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(255, 255, 255, 0.05) 0%, transparent 50%)
            `;

            return `
                <div class="pokemon-tcg-card" style="background: ${backgroundGradient}, ${christmasPattern};">
                    ${pokemon.rarity.includes('Holo') ? '<div class="holo-effect"></div>' : ''}
                    ${pokemon.rarity !== 'Common' ? `<div class="card-rarity">${getRaritySymbol(pokemon.rarity)}</div>` : ''}
                    
                    <!-- Card Header: Pok√©mon Name and HP - FIXED: Extended header area -->
                    <div class="card-header">
                        <div class="card-title">${pokemon.name}</div>
                        <div class="card-hp">HP <span class="hp-value">${pokemon.hp}</span></div>
                    </div>
                    
                    <!-- Main Art Section: Large Animated GIF - FIXED: LARGER CONTAINER -->
                    <div class="card-art-container">
                        <div class="pokemon-type">${pokemon.type}</div>
                        <img src="${pokemon.image}" alt="${pokemon.name}" class="pokemon-art">
                    </div>
                    
                    <!-- Type Badge -->
                    <div class="card-type-section">
                        <span class="type-badge">${pokemon.type} Pok√©mon</span>
                    </div>
                    
                    <!-- Information Section -->
                    <div class="card-info-section">
                        <!-- Description -->
                        <div class="card-description">
                            ${pokemon.description}
                        </div>
                        
                        <!-- Attacks -->
                        <div class="card-attacks">
                            ${pokemon.attacks.map(attack => `
                                <div class="attack">
                                    <span class="attack-name">${attack.name}</span>
                                    <span class="attack-damage">${attack.damage}</span>
                                </div>
                            `).join('')}
                        </div>
                        
                        <!-- Weakness/Resistance -->
                        <div class="card-weakness-resistance">
                            <div class="weakness">
                                <span class="label">Weakness:</span>
                                <span class="value">${pokemon.weakness}</span>
                            </div>
                            <div class="resistance">
                                <span class="label">Resistance:</span>
                                <span class="value">${pokemon.resistance}</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Card Footer - FIXED: Removed illustrator credit -->
                    <div class="card-footer">
                        <div class="card-set">SS-EN001</div>
                    </div>
                </div>
            `;
        }

        // REDESIGNED: Secret Santa Card with new layout - SAME SIZE AS POK√âMON CARDS
        function createSecretSantaCardHTML(santaData) {
            return `
                <div class="pokemon-tcg-card secret-santa-card">
                    <!-- Card Header - FIXED: Extended header area -->
                    <div class="card-header">
                        <div class="card-title">Secret Santa</div>
                        <div class="card-hp">üéÅ</div>
                    </div>
                    
                    <!-- Main Art Section -->
                    <div class="card-art-container">
                        <img src="https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExYjZnbG55MW1sc2FtaXZoaHFkaTltMmRzb3dpdm02cDJ2OG5mY2N5bCZlcD12MV9naWZzX3NlYXJjaCZjdD1n/iBjCNfYLFFTvjFc2A8/giphy.gif" alt="Secret Santa" class="pokemon-art">
                    </div>
                    
                    <!-- Assignment Information - INTEGRATED INTO CARD DESIGN -->
                    <div class="santa-assignment">
                        <div class="player-assignment">
                            Player ${santaData.playerNumber}
                        </div>
                        <div class="assignment-text">
                            üéØ You are assigned to: <strong>Player ${santaData.targetPlayerNumber}</strong>
                        </div>
                    </div>
                    
                    <!-- Information Section -->
                    <div class="card-info-section">
                        <!-- Gift Rules - INTEGRATED INTO CARD DESIGN -->
                        <div class="gift-rules">
                            <h4>Gift Rules:</h4>
                            <ul>
                                <li>Unisex gifts only (should appeal to anyone)</li>
                                <li>No gift cards allowed</li>
                                <li>Gifts should be thoughtful and fun!</li>
                                <li>Budget: $20-30</li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- Card Footer - FIXED: Removed illustrator credit -->
                    <div class="card-footer">
                        <div class="card-set">SS-SS001</div>
                    </div>
                </div>
            `;
        }

        function getRaritySymbol(rarity) {
            switch(rarity) {
                case 'Rare Holo': return '‚òÖ';
                case 'Rare': return 'R';
                case 'Uncommon': return 'U';
                default: return 'C';
            }
        }

        function navigateCarousel(direction) {
            const newIndex = carouselState.currentSlide + direction;
            
            if (newIndex >= 0 && newIndex < carouselState.totalSlides) {
                carouselState.currentSlide = newIndex;
                carouselState.visitedSlides.add(newIndex);
                updateCarouselUI();
            }
        }

        function goToSlide(index) {
            if (index >= 0 && index < carouselState.totalSlides) {
                carouselState.currentSlide = index;
                carouselState.visitedSlides.add(index);
                updateCarouselUI();
            }
        }

        function updateCarouselUI() {
            const carouselTrack = document.getElementById('carouselTrack');
            const carouselProgress = document.getElementById('carouselProgress');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const progressDots = document.querySelectorAll('.progress-dot');
            
            // Update carousel position
            carouselTrack.style.transform = `translateX(-${carouselState.currentSlide * 100}%)`;
            
            // Update progress dots
            progressDots.forEach((dot, index) => {
                dot.classList.toggle('active', index === carouselState.currentSlide);
                dot.classList.toggle('visited', carouselState.visitedSlides.has(index));
            });
            
            // Update button states
            prevBtn.disabled = carouselState.currentSlide === 0;
            nextBtn.disabled = carouselState.currentSlide === carouselState.totalSlides - 1;
        }

        function handleKeyboardNavigation(e) {
            if (e.key === 'ArrowLeft') {
                navigateCarousel(-1);
            } else if (e.key === 'ArrowRight') {
                navigateCarousel(1);
            }
        }

        function initSwipeSupport() {
            const carouselContainer = document.getElementById('carouselContainer');
            let startX = 0;
            let currentX = 0;
            
            carouselContainer.addEventListener('touchstart', (e) => {
                startX = e.touches[0].clientX;
                carouselContainer.classList.add('swiping');
            });
            
            carouselContainer.addEventListener('touchmove', (e) => {
                currentX = e.touches[0].clientX;
            });
            
            carouselContainer.addEventListener('touchend', () => {
                carouselContainer.classList.remove('swiping');
                const diff = startX - currentX;
                
                if (Math.abs(diff) > 50) { // Minimum swipe distance
                    if (diff > 0) {
                        navigateCarousel(1); // Swipe left - next
                    } else {
                        navigateCarousel(-1); // Swipe right - previous
                    }
                }
            });
        }

        // FIXED: Secret Santa Assignment Function with self-assignment prevention
        function generateSecretSantaAssignment() {
            // Generate or get player number
            if (!gameState.playerId) {
                gameState.playerId = 'player_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            }
            
            // FIX: Use secretSantaAssignments as source of truth for player numbers
            const existingAssignments = Object.values(gameState.secretSantaAssignments);
            const assignedPlayerNumbers = new Set(existingAssignments.map(a => a.playerNumber));
            
            // FIX: Assign sequential player number based on existing assignments
            let nextPlayerNumber = 1;
            while (assignedPlayerNumbers.has(nextPlayerNumber)) {
                nextPlayerNumber++;
            }
            carouselState.playerNumber = nextPlayerNumber;
            
            // FIX: Get target assignments from actual data, not future players
            const assignedTargets = new Set(existingAssignments.map(a => a.targetPlayerNumber));
            
            // FIX: Only use actual existing player numbers for target assignment
            const allExistingPlayers = Array.from(assignedPlayerNumbers);
            const availableTargets = allExistingPlayers.filter(num => 
                num !== carouselState.playerNumber && !assignedTargets.has(num)
            );
            
            if (availableTargets.length > 0) {
                // Assign to existing player without a Santa
                const randomIndex = Math.floor(Math.random() * availableTargets.length);
                carouselState.targetPlayerNumber = availableTargets[randomIndex];
            } else if (allExistingPlayers.length > 0 && allExistingPlayers.some(p => p !== carouselState.playerNumber)) {
                // Fallback: assign to any other existing player
                const otherPlayers = allExistingPlayers.filter(p => p !== carouselState.playerNumber);
                const randomIndex = Math.floor(Math.random() * otherPlayers.length);
                carouselState.targetPlayerNumber = otherPlayers[randomIndex];
            } else {
                // First player - assign to future player
                carouselState.targetPlayerNumber = carouselState.playerNumber === 1 ? 2 : 1;
            }
            
            // FIX: Final safety check for self-assignment
            if (carouselState.targetPlayerNumber === carouselState.playerNumber) {
                carouselState.targetPlayerNumber = carouselState.playerNumber + 1;
            }
            
            // REMOVED: Gift suggestion selection - no longer needed
            carouselState.giftSuggestion = "Choose a thoughtful unisex gift within the $20-30 budget!";
            
            // Save the assignment
            gameState.secretSantaAssignments[gameState.playerId] = {
                playerNumber: carouselState.playerNumber,
                targetPlayerNumber: carouselState.targetPlayerNumber,
                giftSuggestion: carouselState.giftSuggestion
            };
        }

        function generateCardPack() {
            carouselState.cards = [];
            
            // Add 8 random Pok√©mon cards (instead of 6)
            const shuffledPokemon = [...pokemonTCGData.pokemonCards].sort(() => Math.random() - 0.5);
            for (let i = 0; i < 8; i++) {
                carouselState.cards.push({
                    type: 'pokemon',
                    data: shuffledPokemon[i]
                });
            }
            
            // Add Secret Santa card as the final card
            carouselState.cards.push({
                type: 'secret-santa',
                data: {
                    playerNumber: carouselState.playerNumber,
                    targetPlayerNumber: carouselState.targetPlayerNumber,
                    giftSuggestion: carouselState.giftSuggestion
                }
            });
            
            console.log('Generated pack with cards:', carouselState.cards);
        }

        function createCardHTML(card, index) {
            switch (card.type) {
                case 'pokemon':
                    return createPokemonCardHTML(card.data);
                case 'secret-santa':
                    return createSecretSantaCardHTML(card.data);
                default:
                    return '';
            }
        }

        // Secret Santa Admin Functions
        function viewAllAssignments() {
            const assignmentsList = document.getElementById('assignmentsList');
            const assignmentsDisplay = document.getElementById('assignmentsDisplay');
            const totalPlayers = document.getElementById('totalPlayers');
            const assignedPlayers = document.getElementById('assignedPlayers');
            const uniqueAssignments = document.getElementById('uniqueAssignments');
            
            assignmentsList.innerHTML = '';
            
            const players = Object.keys(gameState.secretSantaAssignments);
            const targetPlayers = new Set();
            
            players.forEach(playerId => {
                const assignment = gameState.secretSantaAssignments[playerId];
                targetPlayers.add(assignment.targetPlayerNumber);
                
                const assignmentItem = document.createElement('div');
                assignmentItem.className = 'assignment-item';
                
                // Check for duplicates or self-assignments
                if (assignment.playerNumber === assignment.targetPlayerNumber) {
                    assignmentItem.classList.add('self-assigned');
                } else if (Array.from(targetPlayers).filter(p => p === assignment.targetPlayerNumber).length > 1) {
                    assignmentItem.classList.add('duplicate');
                }
                
                assignmentItem.innerHTML = `
                    <div class="player-info">
                        <div class="player-number">Player ${assignment.playerNumber}</div>
                        <div class="player-assignment">‚Üí Player ${assignment.targetPlayerNumber}</div>
                        <div class="player-name">Gift: ${assignment.giftSuggestion}</div>
                    </div>
                `;
                
                assignmentsList.appendChild(assignmentItem);
            });
            
            totalPlayers.textContent = players.length;
            assignedPlayers.textContent = players.length;
            uniqueAssignments.textContent = targetPlayers.size;
            
            assignmentsDisplay.classList.remove('hidden');
        }

        // FIXED: Enhanced Validation Function
        function validateAssignments() {
            const validationResults = document.getElementById('validationResults');
            const players = Object.keys(gameState.secretSantaAssignments);
            const targetCounts = {};
            let hasErrors = false;
            let hasWarnings = false;
            
            // Count how many times each player is targeted
            players.forEach(playerId => {
                const assignment = gameState.secretSantaAssignments[playerId];
                const target = assignment.targetPlayerNumber;
                targetCounts[target] = (targetCounts[target] || 0) + 1;
            });
            
            let validationHTML = '<h4>Assignment Validation</h4>';
            
            // Check for self-assignments
            const selfAssignments = players.filter(playerId => {
                const assignment = gameState.secretSantaAssignments[playerId];
                return assignment.playerNumber === assignment.targetPlayerNumber;
            });
            
            if (selfAssignments.length > 0) {
                hasErrors = true;
                validationHTML += `
                    <div class="validation-item validation-error">
                        ‚ùå ${selfAssignments.length} self-assignment(s) found: Players ${selfAssignments.map(id => gameState.secretSantaAssignments[id].playerNumber).join(', ')}
                    </div>
                `;
            }
            
            // Check for duplicate assignments
            const duplicates = Object.entries(targetCounts).filter(([player, count]) => count > 1);
            if (duplicates.length > 0) {
                hasErrors = true;
                validationHTML += `
                    <div class="validation-item validation-error">
                        ‚ùå ${duplicates.length} player(s) assigned to multiple Santas: ${duplicates.map(([p]) => `Player ${p}`).join(', ')}
                    </div>
                `;
            }
            
            // Check for unassigned players
            const allPlayerNumbers = Array.from({length: Math.max(gameState.playerNumbers.length, 10)}, (_, i) => i + 1);
            const assignedPlayers = new Set(Object.values(gameState.secretSantaAssignments).map(a => a.targetPlayerNumber));
            const unassignedPlayers = allPlayerNumbers.filter(p => !assignedPlayers.has(p));
            
            if (unassignedPlayers.length > 0) {
                hasWarnings = true;
                validationHTML += `
                    <div class="validation-item validation-warning">
                        ‚ö†Ô∏è ${unassignedPlayers.length} player(s) not assigned a Santa: ${unassignedPlayers.join(', ')}
                    </div>
                `;
            }
            
            // Check if all players have different targets
            const uniqueTargets = new Set(Object.values(gameState.secretSantaAssignments).map(a => a.targetPlayerNumber));
            if (uniqueTargets.size !== players.length) {
                hasWarnings = true;
                validationHTML += `
                    <div class="validation-item validation-warning">
                        ‚ö†Ô∏è Some players share the same target (${uniqueTargets.size} unique targets for ${players.length} players)
                    </div>
                `;
            }
            
            if (!hasErrors && !hasWarnings) {
                validationHTML += `
                    <div class="validation-item validation-good">
                        ‚úÖ All assignments are valid!
                    </div>
                    <div class="validation-item validation-good">
                        ‚úÖ Perfect Secret Santa distribution achieved!
                    </div>
                `;
                validationResults.className = 'validation-results';
            } else if (hasErrors) {
                validationResults.className = 'validation-results error';
            } else {
                validationResults.className = 'validation-results warning';
            }
            
            validationResults.innerHTML = validationHTML;
            validationResults.classList.remove('hidden');
        }

        // NEW: Function to fix self-assignments
        function fixSelfAssignments() {
            const players = Object.keys(gameState.secretSantaAssignments);
            let fixedCount = 0;
            
            players.forEach(playerId => {
                const assignment = gameState.secretSantaAssignments[playerId];
                if (assignment.playerNumber === assignment.targetPlayerNumber) {
                    // This is a self-assignment, fix it
                    const allPlayerNumbers = Array.from({length: Math.max(gameState.playerNumbers.length, 10)}, (_, i) => i + 1);
                    const assignedTargets = new Set(players.map(id => gameState.secretSantaAssignments[id].targetPlayerNumber));
                    
                    // Find a new target that's not the current player and not already assigned
                    const newTarget = allPlayerNumbers.find(num => 
                        num !== assignment.playerNumber && !assignedTargets.has(num)
                    ) || 2;
                    
                    assignment.targetPlayerNumber = newTarget;
                    fixedCount++;
                    console.log(`Fixed self-assignment: Player ${assignment.playerNumber} now assigned to Player ${newTarget}`);
                }
            });
            
            if (fixedCount > 0) {
                alert(`Fixed ${fixedCount} self-assignment(s)!`);
                viewAllAssignments();
            } else {
                alert('No self-assignments found to fix.');
            }
        }

        function exportAssignmentsToCSV() {
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Player Number,Assigned To,Gift Suggestion\n";
            
            Object.values(gameState.secretSantaAssignments).forEach(assignment => {
                const row = [
                    assignment.playerNumber,
                    assignment.targetPlayerNumber,
                    `"${assignment.giftSuggestion}"`
                ].join(',');
                csvContent += row + "\n";
            });
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "secret_santa_assignments.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Game Functions - UPDATED WITH WHOLE SNOWMAN HIT AREA
        function startGame() {
            gameState.isGameRunning = true;
            gameState.gameScore = 0;
            gameState.targetsHit = 0;
            gameState.gameTime = 60;
            gameState.targets = [];
            
            document.getElementById('startGameBtn').classList.add('hidden');
            document.getElementById('gameNextBtn').classList.add('hidden');
            
            // Create initial targets
            for (let i = 0; i < 3; i++) {
                createTarget();
            }
            
            // Start game timer
            gameState.gameTimer = setInterval(updateGame, 1000);
            
            // Start game loop
            requestAnimationFrame(gameLoop);
        }

        function createTarget() {
            const x = Math.random() * (canvas.width - 120) + 60;
            const y = Math.random() * (canvas.height - 180) + 90;
            gameState.targets.push(new Snowman(x, y));
        }

        function updateGame() {
            if (!gameState.isGameRunning) return;
            
            gameState.gameTime--;
            updateGameDisplay();
            
            if (gameState.gameTime <= 0) {
                endGame();
            }
            
            // Occasionally add new targets
            if (Math.random() < 0.1 && gameState.targets.length < 5) {
                createTarget();
            }
        }

        function gameLoop() {
            if (!gameState.isGameRunning) return;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw and update targets
            gameState.targets.forEach((target, index) => {
                target.update();
                target.draw();
            });
            
            requestAnimationFrame(gameLoop);
        }

        function updateGameDisplay() {
            document.getElementById('scoreDisplay').textContent = gameState.gameScore;
            document.getElementById('timeDisplay').textContent = gameState.gameTime;
            document.getElementById('targetsDisplay').textContent = gameState.targetsHit;
        }

        function endGame() {
            gameState.isGameRunning = false;
            clearInterval(gameState.gameTimer);
            
            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = 'white';
            ctx.font = 'bold 36px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Game Over!', canvas.width / 2, canvas.height / 2 - 50);
            ctx.font = '24px Arial';
            ctx.fillText(`Final Score: ${gameState.gameScore}`, canvas.width / 2, canvas.height / 2);
            ctx.fillText(`Snowmen Hit: ${gameState.targetsHit}`, canvas.width / 2, canvas.height / 2 + 40);
            
            document.getElementById('gameNextBtn').classList.remove('hidden');
        }

        // Canvas click handler for aim trainer - UPDATED WITH WHOLE SNOWMAN HIT AREA
        canvas.addEventListener('click', (e) => {
            if (!gameState.isGameRunning) return;
            
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // Check if any target was hit
            for (let i = gameState.targets.length - 1; i >= 0; i--) {
                if (gameState.targets[i].isHit(x, y)) {
                    // Target hit!
                    gameState.targets.splice(i, 1);
                    gameState.gameScore += 10;
                    gameState.targetsHit++;
                    updateGameDisplay();
                    
                    // Create explosion effect
                    createExplosion(x, y);
                    
                    // Add new target
                    createTarget();
                    break;
                }
            }
        });

        function createExplosion(x, y) {
            // Create particle effects
            for (let i = 0; i < 10; i++) {
                const angle = Math.random() * Math.PI * 2;
                const speed = Math.random() * 5 + 2;
                const size = Math.random() * 5 + 2;
                
                ctx.fillStyle = `hsl(${Math.random() * 60 + 180}, 100%, 50%)`;
                ctx.beginPath();
                ctx.arc(
                    x + Math.cos(angle) * speed * 5,
                    y + Math.sin(angle) * speed * 5,
                    size,
                    0,
                    Math.PI * 2
                );
                ctx.fill();
            }
        }

        // FIXED: Enhanced saveSubmission function with proper initialization
        async function saveSubmission() {
            // Create submission data
            const submission = {
                id: gameState.playerId,
                name: gameState.playerName,
                email: gameState.playerEmail,
                date: gameState.selectedDate,
                duration: gameState.selectedDuration,
                activity: gameState.selectedActivity,
                location: gameState.selectedLocation,
                attire: gameState.selectedAttire,
                moonshine: gameState.moonshineChoice,
                budget: gameState.budgetAllocation,
                gameScore: gameState.gameScore,
                quoteScore: gameState.quoteScore,
                lolQuoteScore: gameState.lolQuoteScore,
                songScore: gameState.songScore,
                wordleScore: gameState.wordleScore,
                pokemonScore: gameState.pokemonScore,
                timestamp: new Date().toISOString()
            };
            
            // Add to submissions
            if (!gameState.submissions) {
                gameState.submissions = [];
            }
            gameState.submissions.push(submission);
            
            // Update voting data
            updateVotingData();
            
            // Save all data to JSONBin
            const allData = {
                submissions: gameState.submissions || [],
                votingData: gameState.votingData || getDefaultData().votingData,
                durationData: gameState.durationData || getDefaultData().durationData,
                activityData: gameState.activityData || getDefaultData().activityData,
                locationData: gameState.locationData || getDefaultData().locationData,
                attireData: gameState.attireData || getDefaultData().attireData,
                moonshineData: gameState.moonshineData || getDefaultData().moonshineData,
                budgetData: gameState.budgetData || getDefaultData().budgetData,
                secretSantaAssignments: gameState.secretSantaAssignments || {},
                playerNumbers: gameState.playerNumbers || [],
                lastUpdated: new Date().toISOString()
            };
            
            try {
                await saveToJSONBin(allData);
                console.log('‚úÖ Submission saved successfully to JSONBin');
                
                // Also save player ID to localStorage to prevent duplicate submissions
                localStorage.setItem('playerId', gameState.playerId);
            } catch (error) {
                console.error('‚ùå Error saving submission:', error);
                // Still save to localStorage as fallback
                localStorage.setItem('playerId', gameState.playerId);
                localStorage.setItem('christmasPartySubmission', JSON.stringify(submission));
                alert('There was an error saving your submission. Your data has been saved locally.');
            }
        }

        // FIXED: Enhanced updateVotingData function with safety checks
        function updateVotingData() {
            // Initialize voting data if it doesn't exist
            if (!gameState.votingData) {
                gameState.votingData = getDefaultData().votingData;
            }
            if (!gameState.durationData) {
                gameState.durationData = getDefaultData().durationData;
            }
            if (!gameState.activityData) {
                gameState.activityData = getDefaultData().activityData;
            }
            if (!gameState.locationData) {
                gameState.locationData = getDefaultData().locationData;
            }
            if (!gameState.attireData) {
                gameState.attireData = getDefaultData().attireData;
            }
            if (!gameState.moonshineData) {
                gameState.moonshineData = getDefaultData().moonshineData;
            }
            if (!gameState.budgetData) {
                gameState.budgetData = getDefaultData().budgetData;
            }
            
            console.log('Updating voting data with:', {
                selectedDate: gameState.selectedDate,
                gameScore: gameState.gameScore,
                budgetAllocation: gameState.budgetAllocation
            });
            
            // Update date voting with game scores
            if (gameState.selectedDate && gameState.votingData[gameState.selectedDate]) {
                gameState.votingData[gameState.selectedDate].points += gameState.gameScore;
                gameState.votingData[gameState.selectedDate].voters += 1;
                gameState.votingData[gameState.selectedDate].budget += gameState.budgetAllocation[gameState.selectedDate];
            }
            
            // Update budget data
            Object.keys(gameState.budgetAllocation).forEach(date => {
                if (!gameState.budgetData[date]) {
                    gameState.budgetData[date] = 0;
                }
                gameState.budgetData[date] += gameState.budgetAllocation[date];
            });
            
            // Update duration data
            if (gameState.selectedDuration && gameState.durationData[gameState.selectedDuration]) {
                gameState.durationData[gameState.selectedDuration].votes += 1;
                gameState.durationData[gameState.selectedDuration].points += gameState.gameScore;
            }
            
            // Update activity data
            if (gameState.selectedActivity && gameState.activityData[gameState.selectedActivity]) {
                gameState.activityData[gameState.selectedActivity].votes += 1;
            }
            
            // Update location data
            if (gameState.selectedLocation && gameState.locationData[gameState.selectedLocation]) {
                gameState.locationData[gameState.selectedLocation].votes += 1;
            }
            
            // Update attire data
            if (gameState.selectedAttire && gameState.attireData[gameState.selectedAttire]) {
                gameState.attireData[gameState.selectedAttire].votes += 1;
            }
            
            // Update moonshine data
            if (gameState.moonshineChoice && gameState.moonshineData[gameState.moonshineChoice]) {
                gameState.moonshineData[gameState.moonshineChoice].votes += 1;
            }
            
            console.log('Voting data updated successfully');
        }

        function updateResults() {
            const totalAttendees = document.getElementById('totalAttendees');
            totalAttendees.textContent = gameState.submissions.length;
            
            // Update admin section if visible
            if (gameState.isAdmin) {
                viewAllAssignments();
            }
        }

        function resetForm() {
            // Reset form state
            gameState.selectedDate = null;
            gameState.selectedDuration = null;
            gameState.selectedActivity = null;
            gameState.selectedLocation = null;
            gameState.selectedAttire = null;
            gameState.moonshineChoice = null;
            gameState.budgetAllocation = {
                'dec-1': 0,
                'dec-2': 0,
                'dec-3': 0,
                'dec-4': 0
            };
            gameState.playerName = '';
            gameState.playerEmail = '';
            
            // Clear form inputs
            document.getElementById('nameInput').value = '';
            document.getElementById('emailInput').value = '';
            document.getElementById('moonshineSelect').value = '';
            
            // Reset budget sliders
            document.getElementById('budgetDec1').value = 0;
            document.getElementById('budgetDec2').value = 0;
            document.getElementById('budgetDec3').value = 0;
            document.getElementById('budgetDec4').value = 0;
            
            // Deselect all option cards
            document.querySelectorAll('.option-card').forEach(card => {
                card.classList.remove('selected');
            });
        }

        async function clearAllData() {
            if (!confirm('Are you sure you want to clear ALL data? This cannot be undone.')) {
                return;
            }
            
            // Reset game state to default
            const defaultData = getDefaultData();
            Object.assign(gameState, defaultData);
            
            try {
                await saveToJSONBin(defaultData);
                alert('‚úÖ All data has been cleared from JSONBin!');
                location.reload();
            } catch (error) {
                console.error('‚ùå Error clearing data:', error);
                alert('There was an error clearing the data. Please try again.');
            }
        }

        // Add snowflake effect
        function createSnowflakes() {
            const snowflakeContainer = document.createElement('div');
            snowflakeContainer.style.position = 'fixed';
            snowflakeContainer.style.top = '0';
            snowflakeContainer.style.left = '0';
            snowflakeContainer.style.width = '100%';
            snowflakeContainer.style.height = '100%';
            snowflakeContainer.style.pointerEvents = 'none';
            snowflakeContainer.style.zIndex = '1';
            document.body.appendChild(snowflakeContainer);

            for (let i = 0; i < 50; i++) {
                createSnowflake(snowflakeContainer);
            }
        }

        function createSnowflake(container) {
            const snowflake = document.createElement('div');
            snowflake.innerHTML = '‚ùÑ';
            snowflake.classList.add('snowflake');
            snowflake.style.left = Math.random() * 100 + 'vw';
            snowflake.style.animationDuration = (Math.random() * 5 + 5) + 's';
            snowflake.style.animationDelay = Math.random() * 5 + 's';
            snowflake.style.opacity = Math.random() * 0.5 + 0.3;
            snowflake.style.fontSize = (Math.random() * 10 + 10) + 'px';
            container.appendChild(snowflake);

            // Remove snowflake after animation and create new one
            setTimeout(() => {
                snowflake.remove();
                createSnowflake(container);
            }, parseFloat(snowflake.style.animationDuration) * 1000);
        }

        // Start snowflakes
        createSnowflakes();

        // FIXED: Enhanced initialization function
        async function initApp() {
            console.log('üöÄ Initializing Secret Christmas Party App...');
            
            // Show loading message
            console.log('üì° Connecting to JSONBin...');
            
            // Test JSONBin connection
            const connectionSuccess = await testJSONBinConnection();
            
            if (!connectionSuccess) {
                console.warn('‚ö†Ô∏è JSONBin connection failed - using local storage only');
            } else {
                console.log('‚úÖ JSONBin connection successful!');
            }
            
            // Load data with proper error handling
            try {
                const data = await loadFromJSONBin();
                if (data) {
                    // Ensure all required properties exist
                    const defaultData = getDefaultData();
                    Object.keys(defaultData).forEach(key => {
                        if (!data[key]) {
                            data[key] = defaultData[key];
                        }
                    });
                    Object.assign(gameState, data);
                    console.log('‚úÖ Data loaded successfully');
                } else {
                    throw new Error('No data returned from load function');
                }
            } catch (error) {
                console.error('‚ùå Error loading data:', error);
                // Initialize with default data
                const defaultData = getDefaultData();
                Object.assign(gameState, defaultData);
                console.log('üîÑ Using default data structure');
            }
            
            // ENSURE votingData and other critical properties are initialized
            if (!gameState.votingData) {
                gameState.votingData = getDefaultData().votingData;
            }
            if (!gameState.durationData) {
                gameState.durationData = getDefaultData().durationData;
            }
            if (!gameState.activityData) {
                gameState.activityData = getDefaultData().activityData;
            }
            if (!gameState.locationData) {
                gameState.locationData = getDefaultData().locationData;
            }
            if (!gameState.attireData) {
                gameState.attireData = getDefaultData().attireData;
            }
            if (!gameState.moonshineData) {
                gameState.moonshineData = getDefaultData().moonshineData;
            }
            if (!gameState.budgetData) {
                gameState.budgetData = getDefaultData().budgetData;
            }
            if (!gameState.submissions) {
                gameState.submissions = [];
            }
            if (!gameState.secretSantaAssignments) {
                gameState.secretSantaAssignments = {};
            }
            if (!gameState.playerNumbers) {
                gameState.playerNumbers = [];
            }
            
            // Check for URL parameters first - NEW ADDITION
            const urlParams = new URLSearchParams(window.location.search);
            
            if (urlParams.get('results') === 'true') {
                showScreen('publicResultsScreen');
                updatePublicResults();
                return; // Stop further initialization for public results view
            }
            
            // Check for admin mode
            gameState.isAdmin = urlParams.get('admin') === 'true';
            
            // Show admin reset button if in admin mode
            if (gameState.isAdmin) {
                document.getElementById('adminResetBtn').classList.remove('hidden');
                document.getElementById('adminSection').classList.remove('hidden');
            }
            
            // Check if user has already submitted
            const playerId = localStorage.getItem('playerId');
            if (playerId && gameState.submissions.some(s => s.id === playerId) && !gameState.isAdmin) {
                showScreen('alreadySubmittedScreen');
                return;
            }
            
            // Set up event listeners for navigation buttons
            document.getElementById('acceptBtn').addEventListener('click', () => {
                // Mark user as interacted to enable music
                gameState.userInteracted = true;
                showScreen('dateScreen');
            });
            
            // Date selection
            document.querySelectorAll('#dateScreen .option-card').forEach(card => {
                card.addEventListener('click', () => {
                    // Deselect all cards
                    document.querySelectorAll('#dateScreen .option-card').forEach(c => {
                        c.classList.remove('selected');
                    });
                    
                    // Select clicked card
                    card.classList.add('selected');
                    gameState.selectedDate = card.getAttribute('data-date');
                    
                    // Enable next button
                    document.getElementById('dateNextBtn').disabled = false;
                });
            });
            
            document.getElementById('dateNextBtn').addEventListener('click', () => {
                showScreen('durationScreen');
            });
            
            // Duration selection
            document.querySelectorAll('#durationScreen .option-card').forEach(card => {
                card.addEventListener('click', () => {
                    // Deselect all cards
                    document.querySelectorAll('#durationScreen .option-card').forEach(c => {
                        c.classList.remove('selected');
                    });
                    
                    // Select clicked card
                    card.classList.add('selected');
                    gameState.selectedDuration = card.getAttribute('data-duration');
                    
                    // Enable next button
                    document.getElementById('durationNextBtn').disabled = false;
                });
            });
            
            document.getElementById('durationNextBtn').addEventListener('click', () => {
                showScreen('activityScreen');
            });
            
            // Activity selection - NEW ADDITION
            document.querySelectorAll('#activityScreen .option-card').forEach(card => {
                card.addEventListener('click', () => {
                    // Deselect all cards
                    document.querySelectorAll('#activityScreen .option-card').forEach(c => {
                        c.classList.remove('selected');
                    });
                    
                    // Select clicked card
                    card.classList.add('selected');
                    gameState.selectedActivity = card.getAttribute('data-activity');
                    
                    // Enable next button
                    document.getElementById('activityNextBtn').disabled = false;
                });
            });
            
            document.getElementById('activityNextBtn').addEventListener('click', () => {
                showScreen('locationScreen');
            });
            
            // Location selection
            document.querySelectorAll('#locationScreen .option-card').forEach(card => {
                card.addEventListener('click', () => {
                    // Deselect all cards
                    document.querySelectorAll('#locationScreen .option-card').forEach(c => {
                        c.classList.remove('selected');
                    });
                    
                    // Select clicked card
                    card.classList.add('selected');
                    gameState.selectedLocation = card.getAttribute('data-location');
                    
                    // Enable next button
                    document.getElementById('locationNextBtn').disabled = false;
                });
            });
            
            document.getElementById('locationNextBtn').addEventListener('click', () => {
                showScreen('attireScreen');
            });
            
            // Attire selection
            document.querySelectorAll('#attireScreen .option-card').forEach(card => {
                card.addEventListener('click', () => {
                    // Deselect all cards
                    document.querySelectorAll('#attireScreen .option-card').forEach(c => {
                        c.classList.remove('selected');
                    });
                    
                    // Select clicked card
                    card.classList.add('selected');
                    gameState.selectedAttire = card.getAttribute('data-attire');
                    
                    // Enable next button
                    document.getElementById('attireNextBtn').disabled = false;
                });
            });
            
            document.getElementById('attireNextBtn').addEventListener('click', () => {
                showScreen('budgetScreen');
            });
            
            // Budget screen - INITIALIZED IN showScreen FUNCTION
            
            // Budget Next Button
            document.getElementById('budgetNextBtn').addEventListener('click', () => {
                showScreen('moonshineScreen');
            });
            
            // Moonshine screen - FIXED CONTRAST
            document.getElementById('moonshineSelect').addEventListener('change', (e) => {
                gameState.moonshineChoice = e.target.value;
                document.getElementById('moonshineNextBtn').disabled = !gameState.moonshineChoice;
            });
            
            document.getElementById('moonshineNextBtn').addEventListener('click', () => {
                showScreen('quoteGameScreen');
                initQuoteGame();
            });
            
            // Quote game
            document.getElementById('quoteNextBtn').addEventListener('click', () => {
                nextQuote();
            });
            
            document.getElementById('quoteGameNextBtn').addEventListener('click', () => {
                showScreen('lolGameScreen');
                initLolGame();
            });
            
            // LoL game
            document.getElementById('lolQuoteNextBtn').addEventListener('click', () => {
                nextLolQuote();
            });
            
            document.getElementById('lolGameNextBtn').addEventListener('click', () => {
                showScreen('songGameScreen');
                initSongGame();
            });
            
            // Song game
            document.getElementById('songSubmitBtn').addEventListener('click', () => {
                checkSongAnswer();
            });
            
            document.getElementById('songNextBtn').addEventListener('click', () => {
                nextSong();
            });
            
            document.getElementById('songGameNextBtn').addEventListener('click', () => {
                showScreen('wordleGameScreen');
                initWordleGame();
            });
            
            // Wordle game - FIXED VERSION
            document.getElementById('wordleGuessBtn').addEventListener('click', () => {
                checkWordleGuess();
            });
            
            document.getElementById('wordleNextBtn').addEventListener('click', () => {
                showScreen('gameScreen');
            });
            
            // Game screen - UPDATED WITH WHOLE SNOWMAN HIT AREA
            document.getElementById('startGameBtn').addEventListener('click', () => {
                startGame();
            });
            
            document.getElementById('gameNextBtn').addEventListener('click', () => {
                showScreen('pokemonGameScreen');
                initPokemonGame();
            });
            
            // Pok√©mon game - FIXED VERSION (Randomized correct answers)
            document.getElementById('pokemonNextBtn').addEventListener('click', () => {
                nextPokemon();
            });
            
            document.getElementById('pokemonGameNextBtn').addEventListener('click', () => {
                showScreen('secretSantaScreen');
            });
            
            // Secret Santa game - UPDATED WITH POK√âMON TCG CAROUSEL
            document.getElementById('secretSantaNextBtn').addEventListener('click', () => {
                showScreen('registerScreen');
            });
            
            // Registration screen - FIXED VERSION
            document.getElementById('submitBtn').addEventListener('click', () => {
                submitForm();
            });
            
            // Results screen
            document.getElementById('restartBtn').addEventListener('click', () => {
                // Reset the form and show invitation screen
                resetForm();
                showScreen('invitationScreen');
            });
            
            // Already submitted screen - UPDATED to use public results
            document.getElementById('viewResultsBtn').addEventListener('click', () => {
                showScreen('publicResultsScreen');
                updatePublicResults();
            });
            
            document.getElementById('inviteFriendBtn').addEventListener('click', () => {
                resetForm();
                showScreen('invitationScreen');
            });
            
            // Admin reset button
            document.getElementById('adminResetBtn').addEventListener('click', () => {
                clearAllData();
                resetForm();
                showScreen('invitationScreen');
            });
            
            // Song game input - allow Enter key to submit
            document.getElementById('songInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    checkSongAnswer();
                }
            });
            
            // Wordle game input - allow Enter key to submit
            document.getElementById('wordleInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    checkWordleGuess();
                }
            });
            
            // Admin functions for Secret Santa
            document.getElementById('viewAssignmentsBtn').addEventListener('click', viewAllAssignments);
            document.getElementById('validateAssignmentsBtn').addEventListener('click', validateAssignments);
            document.getElementById('exportAssignmentsBtn').addEventListener('click', exportAssignmentsToCSV);
            document.getElementById('fixAssignmentsBtn').addEventListener('click', fixSelfAssignments);
            
            // Admin email notification button
document.getElementById('sendNotificationsBtn').addEventListener('click', async () => {
    if (confirm('Are you sure you want to send December 1st notifications to all voters?')) {
        document.getElementById('adminStatus').textContent = 'Sending emails...';
        await sendAllDecember1stNotifications();
    }
});
            // Add event listener for any user interaction to enable music
            document.addEventListener('click', function enableMusic() {
                gameState.userInteracted = true;
                // Remove the event listener after first interaction
                document.removeEventListener('click', enableMusic);
            });

            // Initialize the app
            updateResults();
            console.log('üéâ Secret Christmas Party App initialized successfully!');
        }

        // Initialize the app when the page loads
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
